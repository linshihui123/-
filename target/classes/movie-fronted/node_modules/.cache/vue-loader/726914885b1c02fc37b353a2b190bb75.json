{"remainingRequest":"D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\src\\components\\KnowledgeGraph.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\src\\components\\KnowledgeGraph.vue","mtime":1769411982949},{"path":"D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1768463919512},{"path":"D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\node_modules\\vue-loader\\lib\\index.js","mtime":1768463917873}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBheGlvcyBmcm9tICdheGlvcycKY29uc3QgZWNoYXJ0cyA9IHJlcXVpcmUoJ2VjaGFydHMnKQoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdLbm93bGVkZ2VHcmFwaCcsCiAgcHJvcHM6IHsKICAgIG1vdmllQ291bnQ6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiAxMAogICAgfSwKICAgIGN1cnJlbnRVc2VyOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgZGVmYXVsdDogbnVsbAogICAgfQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGdyYXBoSW5zdGFuY2U6IG51bGwsCiAgICAgIGdyYXBoRGF0YTogewogICAgICAgIG5vZGVzOiBbXSwKICAgICAgICBlZGdlczogW10KICAgICAgfSwKICAgICAgc2VsZWN0ZWROb2RlVHlwZTogJ2FsbCcsCiAgICAgIHNlYXJjaEtleXdvcmQ6ICcnLAogICAgICBzaG93RGV0YWlsRGlhbG9nOiBmYWxzZSwKICAgICAgbm9kZURldGFpbDogbnVsbCwKICAgICAgbG9jYWxNb3ZpZUNvdW50OiAxMCwKICAgICAgY29yZU1vdmllTWFwOiBuZXcgTWFwKCksIC8vIOWtmOWCqOeUteW9seiKgueCuUlEIC0+IOWtkOiKgueCuUlE5pWw57uECiAgICAgIG5vZGVQb3NpdGlvbnM6IG5ldyBNYXAoKSwgLy8g5a2Y5YKo6IqC54K55L2N572u5YWz57O777yM55So5LqO6Lef6ZqP5ouW5YqoCiAgICAgIGlzRHJhZ2dpbmc6IGZhbHNlLAogICAgICBkcmFnZ2VkTm9kZTogbnVsbCwKICAgICAgZHJhZ1N0YXJ0UG9zOiB7IHg6IDAsIHk6IDAgfQogICAgfQogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgLy8g56Gu5L+d55S75biDRE9N5a6M5YWo5Yqg6L295ZCO5Yid5aeL5YyWCiAgICAgIGlmICh0aGlzLiRyZWZzLmdyYXBoQ2FudmFzKSB7CiAgICAgICAgdGhpcy5pbml0R3JhcGgoKQogICAgICAgIHRoaXMubG9jYWxNb3ZpZUNvdW50ID0gdGhpcy5tb3ZpZUNvdW50IHx8IDEwCiAgICAgICAgdGhpcy5mZXRjaEdyYXBoRGF0YSgpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5Zu+6LCx55S75biDRE9N5YWD57Sg5pyq5om+5Yiw77yBJykKICAgICAgfQogICAgfSkKICB9LAogIGJlZm9yZURlc3Ryb3koKSB7CiAgICAvLyDlvbvlupXplIDmr4Hlrp7kvovlkozkuovku7bvvIzpgb/lhY3lhoXlrZjms4TmvI8KICAgIGlmICh0aGlzLmdyYXBoSW5zdGFuY2UpIHsKICAgICAgdGhpcy5ncmFwaEluc3RhbmNlLm9mZignZHJhZ3N0YXJ0JykKICAgICAgdGhpcy5ncmFwaEluc3RhbmNlLm9mZignZHJhZycpCiAgICAgIHRoaXMuZ3JhcGhJbnN0YW5jZS5vZmYoJ2RyYWdlbmQnKQogICAgICB0aGlzLmdyYXBoSW5zdGFuY2UuZGlzcG9zZSgpCiAgICAgIHRoaXMuZ3JhcGhJbnN0YW5jZSA9IG51bGwKICAgIH0KICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLmhhbmRsZVJlc2l6ZSkKICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIOWkhOeQhueql+WPo+Wkp+Wwj+WPmOWMlgogICAgaGFuZGxlUmVzaXplKCkgewogICAgICBpZiAodGhpcy5ncmFwaEluc3RhbmNlKSB7CiAgICAgICAgdGhpcy5ncmFwaEluc3RhbmNlLnJlc2l6ZSgpCiAgICAgIH0KICAgIH0sCgogICAgaW5pdEdyYXBoKCkgewogICAgICBpZiAoIWVjaGFydHMpIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCdFQ2hhcnRz5bqT5Yqg6L295aSx6LSl77yBJykKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICAvLyDliJ3lp4vljJZFQ2hhcnRz5a6e5L6LCiAgICAgIHRoaXMuZ3JhcGhJbnN0YW5jZSA9IGVjaGFydHMuaW5pdCh0aGlzLiRyZWZzLmdyYXBoQ2FudmFzKQoKICAgICAgLy8g55uR5ZCs56qX5Y+j5aSn5bCP5Y+Y5YyWCiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLmhhbmRsZVJlc2l6ZSkKCiAgICAgIC8vIOe7keWumueCueWHu+S6i+S7tgogICAgICB0aGlzLmdyYXBoSW5zdGFuY2Uub24oJ2NsaWNrJywgKHBhcmFtcykgPT4gewogICAgICAgIGlmIChwYXJhbXMuZGF0YVR5cGUgPT09ICdub2RlJykgewogICAgICAgICAgdGhpcy5zaG93Tm9kZURldGFpbChwYXJhbXMuZGF0YSkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAoKICAgIGZldGNoR3JhcGhEYXRhKCkgewogICAgICBjb25zdCBhcGlVcmwgPSBgaHR0cDovL2xvY2FsaG9zdDo4MDgxL2FwaS9rZy9ncmFwaC1kYXRhP21vdmllQ291bnQ9JHt0aGlzLmxvY2FsTW92aWVDb3VudH1gCiAgICAgIGF4aW9zLmdldChhcGlVcmwpCiAgICAgICAgICAudGhlbihyZXMgPT4gewogICAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgdGhpcy5ncmFwaERhdGEgPSByZXMuZGF0YS5kYXRhIHx8IHJlcy5kYXRhCiAgICAgICAgICAgICAgdGhpcy5yZW5kZXJHcmFwaCgpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goZXJyID0+IHsKICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5pWw5o2u6K+35rGC5aSx6LSl77yaJyArIGVyci5tZXNzYWdlKQogICAgICAgICAgICBjb25zb2xlLmVycm9yKCflm77osLHmlbDmja7or7fmsYLlpLHotKXvvJonLCBlcnIpCiAgICAgICAgICB9KQogICAgfSwKCiAgICAvLyDkvJjljJblkI7nmoToioLngrnlpKflsI/orqHnrpcKICAgIGdldE5vZGVTaXplKG5hbWUsIGlzQ29yZSkgewogICAgICBjb25zdCBmb250U2l6ZSA9IGlzQ29yZSA/IDE0IDogMTIKICAgICAgY29uc3QgYmFzZVNpemUgPSBpc0NvcmUgPyA2MCA6IDQwCiAgICAgIGNvbnN0IGxlbmd0aCA9IG5hbWUgPyBuYW1lLmxlbmd0aCA6IDAKCiAgICAgIC8vIOagueaNruaWh+acrOmVv+W6puiwg+aVtOWkp+WwjwogICAgICBpZiAobGVuZ3RoIDw9IDQpIHJldHVybiBiYXNlU2l6ZQogICAgICBpZiAobGVuZ3RoIDw9IDgpIHJldHVybiBiYXNlU2l6ZSAqIDEuMgogICAgICByZXR1cm4gYmFzZVNpemUgKiAxLjUKICAgIH0sCgogICAgLy8g55Sf5oiQ5Zu+6LCx5pWw5o2u77yI5qC45b+D5pS56L+b77ya5bu656uL6IqC54K56Lef6ZqP5YWz57O777yJCiAgICBnZW5lcmF0ZUdyYXBoRGF0YSgpIHsKICAgICAgbGV0IGFsbE5vZGVzID0gWy4uLnRoaXMuZ3JhcGhEYXRhLm5vZGVzXQogICAgICBsZXQgYWxsRWRnZXMgPSBbLi4udGhpcy5ncmFwaERhdGEuZWRnZXNdCgogICAgICAvLyDmuIXnqbrkuYvliY3nmoTmmKDlsIQKICAgICAgdGhpcy5jb3JlTW92aWVNYXAuY2xlYXIoKQogICAgICB0aGlzLm5vZGVQb3NpdGlvbnMuY2xlYXIoKQoKICAgICAgLy8g562b6YCJ6YC76L6RCiAgICAgIGxldCBmaWx0ZXJlZE5vZGVzID0gW10KICAgICAgbGV0IGZpbHRlcmVkRWRnZXMgPSBbXQoKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWROb2RlVHlwZSA9PT0gJ2FsbCcpIHsKICAgICAgICBmaWx0ZXJlZE5vZGVzID0gYWxsTm9kZXMKICAgICAgICBmaWx0ZXJlZEVkZ2VzID0gYWxsRWRnZXMKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0YXJnZXROb2RlcyA9IGFsbE5vZGVzLmZpbHRlcihub2RlID0+IG5vZGUudHlwZSA9PT0gdGhpcy5zZWxlY3RlZE5vZGVUeXBlKQogICAgICAgIGlmICh0YXJnZXROb2Rlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJldHVybiB7IG5vZGVzOiBbXSwgZWRnZXM6IFtdLCBjYXRlZ29yaWVzOiB0aGlzLmdldE5vZGVDYXRlZ29yaWVzKCkgfQogICAgICAgIH0KICAgICAgICBjb25zdCB0YXJnZXROb2RlSWRzID0gdGFyZ2V0Tm9kZXMubWFwKG5vZGUgPT4gbm9kZS5pZCkKICAgICAgICBjb25zdCByZWxhdGVkRWRnZXMgPSBhbGxFZGdlcy5maWx0ZXIoZWRnZSA9PgogICAgICAgICAgICB0YXJnZXROb2RlSWRzLmluY2x1ZGVzKGVkZ2Uuc291cmNlKSB8fCB0YXJnZXROb2RlSWRzLmluY2x1ZGVzKGVkZ2UudGFyZ2V0KQogICAgICAgICkKICAgICAgICBjb25zdCByZWxhdGVkTm9kZUlkcyA9IG5ldyBTZXQoKQogICAgICAgIHJlbGF0ZWRFZGdlcy5mb3JFYWNoKGVkZ2UgPT4gewogICAgICAgICAgcmVsYXRlZE5vZGVJZHMuYWRkKGVkZ2Uuc291cmNlKQogICAgICAgICAgcmVsYXRlZE5vZGVJZHMuYWRkKGVkZ2UudGFyZ2V0KQogICAgICAgIH0pCiAgICAgICAgZmlsdGVyZWROb2RlcyA9IGFsbE5vZGVzLmZpbHRlcihub2RlID0+IHJlbGF0ZWROb2RlSWRzLmhhcyhub2RlLmlkKSkKICAgICAgICBmaWx0ZXJlZEVkZ2VzID0gcmVsYXRlZEVkZ2VzCiAgICAgIH0KCiAgICAgIC8vIOWFs+mUruivjeaQnOe0ogogICAgICBpZiAodGhpcy5zZWFyY2hLZXl3b3JkKSB7CiAgICAgICAgY29uc3Qga2V5d29yZCA9IHRoaXMuc2VhcmNoS2V5d29yZC50cmltKCkudG9Mb3dlckNhc2UoKQogICAgICAgIGZpbHRlcmVkTm9kZXMgPSBmaWx0ZXJlZE5vZGVzLmZpbHRlcihub2RlID0+IG5vZGUubmFtZSAmJiBub2RlLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhrZXl3b3JkKSkKICAgICAgICBjb25zdCBmaWx0ZXJlZE5vZGVJZHMgPSBmaWx0ZXJlZE5vZGVzLm1hcChub2RlID0+IG5vZGUuaWQpCiAgICAgICAgZmlsdGVyZWRFZGdlcyA9IGZpbHRlcmVkRWRnZXMuZmlsdGVyKGVkZ2UgPT4KICAgICAgICAgICAgZmlsdGVyZWROb2RlSWRzLmluY2x1ZGVzKGVkZ2Uuc291cmNlKSAmJiBmaWx0ZXJlZE5vZGVJZHMuaW5jbHVkZXMoZWRnZS50YXJnZXQpCiAgICAgICAgKQogICAgICB9CgogICAgICBjb25zdCBub2RlQ2F0ZWdvcmllcyA9IHRoaXMuZ2V0Tm9kZUNhdGVnb3JpZXMoKQoKICAgICAgLy8g5pS26ZuG5omA5pyJ55S15b2x6IqC54K5CiAgICAgIGNvbnN0IG1vdmllTm9kZXMgPSBmaWx0ZXJlZE5vZGVzLmZpbHRlcihub2RlID0+IG5vZGUudHlwZSA9PT0gJ21vdmllJykKCiAgICAgIC8vIOesrOS4gOatpe+8muW7uueri+eUteW9seiKgueCueS4juWtkOiKgueCueeahOaYoOWwhOWFs+ezuwogICAgICBtb3ZpZU5vZGVzLmZvckVhY2gobW92aWVOb2RlID0+IHsKICAgICAgICBpZiAoIW1vdmllTm9kZS5pZCkgcmV0dXJuCgogICAgICAgIC8vIOaJvuWIsOS4juW9k+WJjeeUteW9seiKgueCueebuOWFs+eahOi+uQogICAgICAgIGNvbnN0IG1vdmllRWRnZXMgPSBmaWx0ZXJlZEVkZ2VzLmZpbHRlcihlZGdlID0+CiAgICAgICAgICAgIGVkZ2Uuc291cmNlID09PSBtb3ZpZU5vZGUuaWQgfHwgZWRnZS50YXJnZXQgPT09IG1vdmllTm9kZS5pZAogICAgICAgICkKCiAgICAgICAgLy8g5pS26ZuG5omA5pyJ5a2Q6IqC54K5SUQKICAgICAgICBjb25zdCBjaGlsZE5vZGVJZHMgPSBbXQogICAgICAgIG1vdmllRWRnZXMuZm9yRWFjaChlZGdlID0+IHsKICAgICAgICAgIGNvbnN0IGNoaWxkSWQgPSBlZGdlLnNvdXJjZSA9PT0gbW92aWVOb2RlLmlkID8gZWRnZS50YXJnZXQgOiBlZGdlLnNvdXJjZQogICAgICAgICAgLy8g5o6S6Zmk55S15b2x6IqC54K56Ieq6LqrCiAgICAgICAgICBjb25zdCBjaGlsZE5vZGUgPSBmaWx0ZXJlZE5vZGVzLmZpbmQobiA9PiBuLmlkID09PSBjaGlsZElkICYmIG4udHlwZSAhPT0gJ21vdmllJykKICAgICAgICAgIGlmIChjaGlsZE5vZGUpIHsKICAgICAgICAgICAgY2hpbGROb2RlSWRzLnB1c2goY2hpbGRJZCkKICAgICAgICAgIH0KICAgICAgICB9KQoKICAgICAgICAvLyDlrZjlgqjmmKDlsITlhbPns7sKICAgICAgICB0aGlzLmNvcmVNb3ZpZU1hcC5zZXQobW92aWVOb2RlLmlkLCBjaGlsZE5vZGVJZHMpCgogICAgICAgIC8vIOS4uuavj+S4quWtkOiKgueCueWtmOWCqOWFtueItueUteW9seiKgueCueeahOS9jee9ruWFs+ezuwogICAgICAgIGNoaWxkTm9kZUlkcy5mb3JFYWNoKGNoaWxkSWQgPT4gewogICAgICAgICAgaWYgKCF0aGlzLm5vZGVQb3NpdGlvbnMuaGFzKGNoaWxkSWQpKSB7CiAgICAgICAgICAgIHRoaXMubm9kZVBvc2l0aW9ucy5zZXQoY2hpbGRJZCwgbmV3IFNldCgpKQogICAgICAgICAgfQogICAgICAgICAgdGhpcy5ub2RlUG9zaXRpb25zLmdldChjaGlsZElkKS5hZGQobW92aWVOb2RlLmlkKQogICAgICAgIH0pCiAgICAgIH0pCgogICAgICAvLyDnrKzkuozmraXvvJrorqHnrpfluIPlsYAKICAgICAgY29uc3Qgbm9kZXMgPSBbXQogICAgICBjb25zdCBlZGdlcyA9IFtdCgogICAgICAvLyDorqHnrpfnlLvluIPkuK3lv4PngrkKICAgICAgY29uc3QgY2FudmFzV2lkdGggPSB0aGlzLiRyZWZzLmdyYXBoQ2FudmFzLm9mZnNldFdpZHRoCiAgICAgIGNvbnN0IGNhbnZhc0hlaWdodCA9IHRoaXMuJHJlZnMuZ3JhcGhDYW52YXMub2Zmc2V0SGVpZ2h0CiAgICAgIGNvbnN0IGNlbnRlclggPSBjYW52YXNXaWR0aCAvIDIKICAgICAgY29uc3QgY2VudGVyWSA9IGNhbnZhc0hlaWdodCAvIDIKCiAgICAgIC8vIOeUteW9seiKgueCueW4g+WxgOWPguaVsAogICAgICBjb25zdCBtb3ZpZVNwYWNpbmdYID0gY2FudmFzV2lkdGggKiAwLjggLyBNYXRoLm1heCgxLCBNYXRoLmNlaWwoTWF0aC5zcXJ0KG1vdmllTm9kZXMubGVuZ3RoKSkpCiAgICAgIGNvbnN0IG1vdmllU3BhY2luZ1kgPSBjYW52YXNIZWlnaHQgKiAwLjggLyBNYXRoLm1heCgxLCBNYXRoLmNlaWwoTWF0aC5zcXJ0KG1vdmllTm9kZXMubGVuZ3RoKSkpCgogICAgICAvLyDlpITnkIbnlLXlvbHoioLngrkKICAgICAgbW92aWVOb2Rlcy5mb3JFYWNoKChtb3ZpZU5vZGUsIGluZGV4KSA9PiB7CiAgICAgICAgaWYgKCFtb3ZpZU5vZGUuaWQpIHJldHVybgoKICAgICAgICAvLyDorqHnrpfnlLXlvbHoioLngrnkvY3nva7vvIjnvZHmoLzluIPlsYDvvIkKICAgICAgICBjb25zdCByb3cgPSBNYXRoLmZsb29yKGluZGV4IC8gTWF0aC5jZWlsKE1hdGguc3FydChtb3ZpZU5vZGVzLmxlbmd0aCkpKQogICAgICAgIGNvbnN0IGNvbCA9IGluZGV4ICUgTWF0aC5jZWlsKE1hdGguc3FydChtb3ZpZU5vZGVzLmxlbmd0aCkpCiAgICAgICAgY29uc3QgbW92aWVYID0gY2VudGVyWCAtIChtb3ZpZVNwYWNpbmdYICogKE1hdGguY2VpbChNYXRoLnNxcnQobW92aWVOb2Rlcy5sZW5ndGgpKSAtIDEpIC8gMikgKyBjb2wgKiBtb3ZpZVNwYWNpbmdYCiAgICAgICAgY29uc3QgbW92aWVZID0gY2VudGVyWSAtIChtb3ZpZVNwYWNpbmdZICogKE1hdGguY2VpbChNYXRoLnNxcnQobW92aWVOb2Rlcy5sZW5ndGgpKSAtIDEpIC8gMikgKyByb3cgKiBtb3ZpZVNwYWNpbmdZCgogICAgICAgIC8vIOa3u+WKoOeUteW9seiKgueCuQogICAgICAgIG5vZGVzLnB1c2goewogICAgICAgICAgaWQ6IG1vdmllTm9kZS5pZCwKICAgICAgICAgIG5hbWU6IG1vdmllTm9kZS5uYW1lLAogICAgICAgICAgY2F0ZWdvcnk6IDAsCiAgICAgICAgICB4OiBtb3ZpZVgsCiAgICAgICAgICB5OiBtb3ZpZVksCiAgICAgICAgICBzeW1ib2xTaXplOiB0aGlzLmdldE5vZGVTaXplKG1vdmllTm9kZS5uYW1lLCB0cnVlKSwKICAgICAgICAgIGl0ZW1TdHlsZTogbm9kZUNhdGVnb3JpZXNbMF0uaXRlbVN0eWxlLAogICAgICAgICAgbGFiZWw6IHsKICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgZm9udFNpemU6IDEyLAogICAgICAgICAgICBmb250V2VpZ2h0OiAnYm9sZCcsCiAgICAgICAgICAgIGNvbG9yOiAnIzAwMCcsCiAgICAgICAgICAgIG92ZXJmbG93OiAnYnJlYWsnLAogICAgICAgICAgICBsaW5lSGVpZ2h0OiAxNgogICAgICAgICAgfSwKICAgICAgICAgIGRyYWdnYWJsZTogdHJ1ZSwKICAgICAgICAgIHR5cGU6ICdtb3ZpZScKICAgICAgICB9KQoKICAgICAgICAvLyDmt7vliqDnlLXlvbHoioLngrnnmoTlrZDoioLngrkKICAgICAgICBjb25zdCBjaGlsZE5vZGVJZHMgPSB0aGlzLmNvcmVNb3ZpZU1hcC5nZXQobW92aWVOb2RlLmlkKSB8fCBbXQogICAgICAgIGNoaWxkTm9kZUlkcy5mb3JFYWNoKChjaGlsZElkLCBjaGlsZEluZGV4KSA9PiB7CiAgICAgICAgICBjb25zdCBjaGlsZE5vZGUgPSBmaWx0ZXJlZE5vZGVzLmZpbmQobiA9PiBuLmlkID09PSBjaGlsZElkKQogICAgICAgICAgaWYgKCFjaGlsZE5vZGUpIHJldHVybgoKICAgICAgICAgIC8vIOajgOafpeaYr+WQpuW3sue7j+a3u+WKoOi/h+ivpeWtkOiKgueCue+8iOmBv+WFjemHjeWkje+8iQogICAgICAgICAgaWYgKG5vZGVzLmZpbmQobiA9PiBuLmlkID09PSBjaGlsZElkKSkgcmV0dXJuCgogICAgICAgICAgLy8g6K6h566X5a2Q6IqC54K55L2N572u77yI5Zu057uV55S15b2x6IqC54K577yJCiAgICAgICAgICBjb25zdCBhbmdsZSA9IChjaGlsZEluZGV4IC8gY2hpbGROb2RlSWRzLmxlbmd0aCkgKiBNYXRoLlBJICogMgogICAgICAgICAgY29uc3QgcmFkaXVzID0gTWF0aC5taW4obW92aWVTcGFjaW5nWCwgbW92aWVTcGFjaW5nWSkgKiAwLjYKICAgICAgICAgIGNvbnN0IGNoaWxkWCA9IG1vdmllWCArIHJhZGl1cyAqIE1hdGguY29zKGFuZ2xlKQogICAgICAgICAgY29uc3QgY2hpbGRZID0gbW92aWVZICsgcmFkaXVzICogTWF0aC5zaW4oYW5nbGUpCgogICAgICAgICAgLy8g56Gu5a6a6IqC54K557G75Z6L57Si5byVCiAgICAgICAgICBjb25zdCBjYXRJZHggPSBub2RlQ2F0ZWdvcmllcy5maW5kSW5kZXgoYyA9PiBjLm5hbWUgPT09IGNoaWxkTm9kZS50eXBlKQoKICAgICAgICAgIG5vZGVzLnB1c2goewogICAgICAgICAgICBpZDogY2hpbGROb2RlLmlkLAogICAgICAgICAgICBuYW1lOiBjaGlsZE5vZGUubmFtZSwKICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdElkeCA+PSAwID8gY2F0SWR4IDogNCwKICAgICAgICAgICAgeDogY2hpbGRYLAogICAgICAgICAgICB5OiBjaGlsZFksCiAgICAgICAgICAgIHN5bWJvbFNpemU6IHRoaXMuZ2V0Tm9kZVNpemUoY2hpbGROb2RlLm5hbWUsIGZhbHNlKSwKICAgICAgICAgICAgaXRlbVN0eWxlOiBub2RlQ2F0ZWdvcmllc1tjYXRJZHggPj0gMCA/IGNhdElkeCA6IDRdLml0ZW1TdHlsZSwKICAgICAgICAgICAgbGFiZWw6IHsKICAgICAgICAgICAgICBzaG93OiB0cnVlLAogICAgICAgICAgICAgIGZvbnRTaXplOiAxMCwKICAgICAgICAgICAgICBjb2xvcjogJyMwMDAnLAogICAgICAgICAgICAgIG92ZXJmbG93OiAnYnJlYWsnLAogICAgICAgICAgICAgIGxpbmVIZWlnaHQ6IDE0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRyYWdnYWJsZTogdHJ1ZSwKICAgICAgICAgICAgdHlwZTogY2hpbGROb2RlLnR5cGUKICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgICAgfSkKCiAgICAgIC8vIOesrOS4ieatpe+8mua3u+WKoOi+uQogICAgICBmaWx0ZXJlZEVkZ2VzLmZvckVhY2goZWRnZSA9PiB7CiAgICAgICAgLy8g56Gu5L+d6L6555qE5Lik5Liq6IqC54K56YO95a2Y5ZyoCiAgICAgICAgaWYgKG5vZGVzLmZpbmQobiA9PiBuLmlkID09PSBlZGdlLnNvdXJjZSkgJiYgbm9kZXMuZmluZChuID0+IG4uaWQgPT09IGVkZ2UudGFyZ2V0KSkgewogICAgICAgICAgZWRnZXMucHVzaCh7CiAgICAgICAgICAgIHNvdXJjZTogZWRnZS5zb3VyY2UsCiAgICAgICAgICAgIHRhcmdldDogZWRnZS50YXJnZXQsCiAgICAgICAgICAgIGxhYmVsOiB7CiAgICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgICBmb3JtYXR0ZXI6IGVkZ2UubGFiZWwsCiAgICAgICAgICAgICAgZm9udFNpemU6IDEwLAogICAgICAgICAgICAgIGNvbG9yOiAnIzY2NicsCiAgICAgICAgICAgICAgcG9zaXRpb246ICdtaWRkbGUnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxpbmVTdHlsZTogewogICAgICAgICAgICAgIHdpZHRoOiAxLjUsCiAgICAgICAgICAgICAgY29sb3I6ICcjQjBDNERFJywKICAgICAgICAgICAgICB0eXBlOiAnc29saWQnLAogICAgICAgICAgICAgIG9wYWNpdHk6IDAuOAogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSkKCiAgICAgIHJldHVybiB7CiAgICAgICAgbm9kZXM6IG5vZGVzLAogICAgICAgIGVkZ2VzOiBlZGdlcywKICAgICAgICBjYXRlZ29yaWVzOiBub2RlQ2F0ZWdvcmllcwogICAgICB9CiAgICB9LAoKICAgIGdldE5vZGVDYXRlZ29yaWVzKCkgewogICAgICByZXR1cm4gWwogICAgICAgIHsgbmFtZTogJ21vdmllJywgaXRlbVN0eWxlOiB7IGNvbG9yOiAnIzhBMkJFMicsIGJvcmRlcldpZHRoOiAyLCBib3JkZXJDb2xvcjogJyM0QjAwODInIH0gfSwKICAgICAgICB7IG5hbWU6ICdkaXJlY3RvcicsIGl0ZW1TdHlsZTogeyBjb2xvcjogJyNGRjQ1MDAnLCBib3JkZXJXaWR0aDogMSwgYm9yZGVyQ29sb3I6ICcjRkY2MzQ3JyB9IH0sCiAgICAgICAgeyBuYW1lOiAnYWN0b3InLCBpdGVtU3R5bGU6IHsgY29sb3I6ICcjRkY2MzQ3JywgYm9yZGVyV2lkdGg6IDEsIGJvcmRlckNvbG9yOiAnI0ZGNDUwMCcgfSB9LAogICAgICAgIHsgbmFtZTogJ3JlZ2lvbicsIGl0ZW1TdHlsZTogeyBjb2xvcjogJyNGRkQ3MDAnLCBib3JkZXJXaWR0aDogMSwgYm9yZGVyQ29sb3I6ICcjRkZBNTAwJyB9IH0sCiAgICAgICAgeyBuYW1lOiAnZ2VucmUnLCBpdGVtU3R5bGU6IHsgY29sb3I6ICcjMzJDRDMyJywgYm9yZGVyV2lkdGg6IDEsIGJvcmRlckNvbG9yOiAnIzIyOEIyMicgfSB9CiAgICAgIF0KICAgIH0sCgogICAgcmVuZGVyR3JhcGgoKSB7CiAgICAgIGlmICghdGhpcy5ncmFwaEluc3RhbmNlKSByZXR1cm4KCiAgICAgIGNvbnN0IGdyYXBoRGF0YSA9IHRoaXMuZ2VuZXJhdGVHcmFwaERhdGEoKQogICAgICBjb25zdCBfdGhpcyA9IHRoaXMKCiAgICAgIC8vIOiuoeeul+eUu+W4g+Wkp+WwjwogICAgICBjb25zdCBjb250YWluZXJXaWR0aCA9IHRoaXMuJHJlZnMuZ3JhcGhDYW52YXMub2Zmc2V0V2lkdGgKICAgICAgY29uc3QgY29udGFpbmVySGVpZ2h0ID0gdGhpcy4kcmVmcy5ncmFwaENhbnZhcy5vZmZzZXRIZWlnaHQKCiAgICAgIC8vIEVDaGFydHPphY3nva4KICAgICAgY29uc3Qgb3B0aW9uID0gewogICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNGRkZGRkYnLAogICAgICAgIHRvb2x0aXA6IHsKICAgICAgICAgIHRyaWdnZXI6ICdpdGVtJywKICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMjU1LDI1NSwyNTUsMC45NSknLAogICAgICAgICAgYm9yZGVyQ29sb3I6ICcjRTVFNUU1JywKICAgICAgICAgIGJvcmRlcldpZHRoOiAxLAogICAgICAgICAgYm9yZGVyUmFkaXVzOiA2LAogICAgICAgICAgcGFkZGluZzogWzgsIDEyXSwKICAgICAgICAgIHRleHRTdHlsZTogeyBjb2xvcjogJyMzMzMnLCBmb250U2l6ZTogMTIgfSwKICAgICAgICAgIGZvcm1hdHRlcjogcGFyYW1zID0+IHsKICAgICAgICAgICAgaWYgKHBhcmFtcy5kYXRhVHlwZSA9PT0gJ25vZGUnKSB7CiAgICAgICAgICAgICAgY29uc3QgdHlwZXMgPSBbJ+eUteW9sScsJ+WvvOa8lCcsJ+a8lOWRmCcsJ+WcsOWMuicsJ+exu+WeiyddCiAgICAgICAgICAgICAgcmV0dXJuIGAke3BhcmFtcy5uYW1lfTxici8+57G75Z6L77yaJHt0eXBlc1twYXJhbXMuZGF0YS5jYXRlZ29yeV0gfHwgJ+acquefpSd9YAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwYXJhbXMuZGF0YVR5cGUgPT09ICdlZGdlJyA/IGDlhbPns7vvvJoke3BhcmFtcy5kYXRhLmxhYmVsLmZvcm1hdHRlcn1gIDogcGFyYW1zLm5hbWUKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGxlZ2VuZDogewogICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgIGRhdGE6IFsKICAgICAgICAgICAge25hbWU6J+eUteW9sScsIGljb246ICdjaXJjbGUnLCB0ZXh0U3R5bGU6IHtjb2xvcjogJyM4QTJCRTInfX0sCiAgICAgICAgICAgIHtuYW1lOiflr7zmvJQnLCBpY29uOiAnY2lyY2xlJywgdGV4dFN0eWxlOiB7Y29sb3I6ICcjRkY0NTAwJ319LAogICAgICAgICAgICB7bmFtZTon5ryU5ZGYJywgaWNvbjogJ2NpcmNsZScsIHRleHRTdHlsZToge2NvbG9yOiAnI0ZGNjM0Nyd9fSwKICAgICAgICAgICAge25hbWU6J+WcsOWMuicsIGljb246ICdjaXJjbGUnLCB0ZXh0U3R5bGU6IHtjb2xvcjogJyNGRkQ3MDAnfX0sCiAgICAgICAgICAgIHtuYW1lOifnsbvlnosnLCBpY29uOiAnY2lyY2xlJywgdGV4dFN0eWxlOiB7Y29sb3I6ICcjMzJDRDMyJ319CiAgICAgICAgICBdLAogICAgICAgICAgdG9wOiAxMCwKICAgICAgICAgIGxlZnQ6ICdjZW50ZXInLAogICAgICAgICAgaXRlbUdhcDogMTUsCiAgICAgICAgICB0ZXh0U3R5bGU6IHsgZm9udFNpemU6IDEyLCBjb2xvcjogJyMwMDAnIH0sCiAgICAgICAgICBpY29uOiAnY2lyY2xlJwogICAgICAgIH0sCiAgICAgICAgc2VyaWVzOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHR5cGU6ICdncmFwaCcsCiAgICAgICAgICAgIGxheW91dDogJ25vbmUnLAogICAgICAgICAgICByb2FtOiB0cnVlLAogICAgICAgICAgICB6b29tOiAxLAogICAgICAgICAgICBjZW50ZXI6IFsnNTAlJywgJzUwJSddLAogICAgICAgICAgICBkcmFnZ2FibGU6IHRydWUsCiAgICAgICAgICAgIHN5bWJvbDogJ2NpcmNsZScsCiAgICAgICAgICAgIHN5bWJvbFNpemU6IDQwLAogICAgICAgICAgICBlZGdlU3ltYm9sOiBbJ2NpcmNsZScsICdhcnJvdyddLAogICAgICAgICAgICBlZGdlU3ltYm9sU2l6ZTogWzQsIDEwXSwKICAgICAgICAgICAgY3Vyc29yOiAnbW92ZScsCiAgICAgICAgICAgIGxhYmVsOiB7CiAgICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogJ2luc2lkZScsCiAgICAgICAgICAgICAgY29sb3I6ICcjMDAwJywKICAgICAgICAgICAgICBmb250U2l6ZTogMTAsCiAgICAgICAgICAgICAgZm9udFdlaWdodDogJ25vcm1hbCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZWRnZUxhYmVsOiB7CiAgICAgICAgICAgICAgc2hvdzogdHJ1ZSwKICAgICAgICAgICAgICBwb3NpdGlvbjogJ21pZGRsZScsCiAgICAgICAgICAgICAgZm9udFNpemU6IDEwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRhdGE6IGdyYXBoRGF0YS5ub2RlcywKICAgICAgICAgICAgbGlua3M6IGdyYXBoRGF0YS5lZGdlcywKICAgICAgICAgICAgY2F0ZWdvcmllczogZ3JhcGhEYXRhLmNhdGVnb3JpZXMsCiAgICAgICAgICAgIGxpbmVTdHlsZTogewogICAgICAgICAgICAgIGNvbG9yOiAnc291cmNlJywKICAgICAgICAgICAgICB3aWR0aDogMS41LAogICAgICAgICAgICAgIGN1cnZlbmVzczogMC4yLAogICAgICAgICAgICAgIG9wYWNpdHk6IDAuOAogICAgICAgICAgICB9LAogICAgICAgICAgICBlbXBoYXNpczogewogICAgICAgICAgICAgIGZvY3VzOiAnYWRqYWNlbmN5JywKICAgICAgICAgICAgICBsaW5lU3R5bGU6IHsKICAgICAgICAgICAgICAgIHdpZHRoOiAyLAogICAgICAgICAgICAgICAgb3BhY2l0eTogMQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfQoKICAgICAgLy8g5riF56m65bm26K6+572u5paw6YWN572uCiAgICAgIHRoaXMuZ3JhcGhJbnN0YW5jZS5jbGVhcigpCiAgICAgIHRoaXMuZ3JhcGhJbnN0YW5jZS5zZXRPcHRpb24ob3B0aW9uLCB0cnVlKQoKICAgICAgLy8g56e76Zmk5pen55qE5LqL5Lu255uR5ZCs5ZmoCiAgICAgIHRoaXMuZ3JhcGhJbnN0YW5jZS5vZmYoJ2RyYWdzdGFydCcpCiAgICAgIHRoaXMuZ3JhcGhJbnN0YW5jZS5vZmYoJ2RyYWcnKQogICAgICB0aGlzLmdyYXBoSW5zdGFuY2Uub2ZmKCdkcmFnZW5kJykKCiAgICAgIC8vIOaLluWKqOW8gOWni+S6i+S7tgogICAgICB0aGlzLmdyYXBoSW5zdGFuY2Uub24oJ2RyYWdzdGFydCcsIGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgIGlmIChwYXJhbXMuZGF0YVR5cGUgIT09ICdub2RlJykgcmV0dXJuCgogICAgICAgIF90aGlzLmlzRHJhZ2dpbmcgPSB0cnVlCiAgICAgICAgX3RoaXMuZHJhZ2dlZE5vZGUgPSBwYXJhbXMuZGF0YQogICAgICAgIF90aGlzLmRyYWdTdGFydFBvcyA9IHsKICAgICAgICAgIHg6IHBhcmFtcy5kYXRhLngsCiAgICAgICAgICB5OiBwYXJhbXMuZGF0YS55CiAgICAgICAgfQogICAgICB9KQoKICAgICAgLy8g5ouW5Yqo5LqL5Lu2IC0g5qC45b+D77ya5a2Q6IqC54K56Lef6ZqP54i26IqC54K5CiAgICAgIHRoaXMuZ3JhcGhJbnN0YW5jZS5vbignZHJhZycsIGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgIGlmICghX3RoaXMuaXNEcmFnZ2luZyB8fCBwYXJhbXMuZGF0YVR5cGUgIT09ICdub2RlJykgcmV0dXJuCgogICAgICAgIGNvbnN0IGN1cnJlbnROb2RlID0gcGFyYW1zLmRhdGEKICAgICAgICBjb25zdCBkeCA9IGN1cnJlbnROb2RlLnggLSBfdGhpcy5kcmFnU3RhcnRQb3MueAogICAgICAgIGNvbnN0IGR5ID0gY3VycmVudE5vZGUueSAtIF90aGlzLmRyYWdTdGFydFBvcy55CgogICAgICAgIC8vIOWmguaenOaYr+eUteW9seiKgueCueiiq+aLluWKqO+8jOenu+WKqOaJgOacieWtkOiKgueCuQogICAgICAgIGlmIChjdXJyZW50Tm9kZS50eXBlID09PSAnbW92aWUnICYmIF90aGlzLmNvcmVNb3ZpZU1hcC5oYXMoY3VycmVudE5vZGUuaWQpKSB7CiAgICAgICAgICBjb25zdCBjaGlsZE5vZGVJZHMgPSBfdGhpcy5jb3JlTW92aWVNYXAuZ2V0KGN1cnJlbnROb2RlLmlkKQogICAgICAgICAgY29uc3QgZ3JhcGhPcHRpb24gPSBfdGhpcy5ncmFwaEluc3RhbmNlLmdldE9wdGlvbigpCiAgICAgICAgICBjb25zdCBhbGxOb2RlcyA9IGdyYXBoT3B0aW9uLnNlcmllc1swXS5kYXRhCgogICAgICAgICAgLy8g5pu05paw5omA5pyJ5a2Q6IqC54K555qE5L2N572uCiAgICAgICAgICBjaGlsZE5vZGVJZHMuZm9yRWFjaChjaGlsZElkID0+IHsKICAgICAgICAgICAgY29uc3QgY2hpbGROb2RlID0gYWxsTm9kZXMuZmluZChuID0+IG4uaWQgPT09IGNoaWxkSWQpCiAgICAgICAgICAgIGlmIChjaGlsZE5vZGUpIHsKICAgICAgICAgICAgICBjaGlsZE5vZGUueCArPSBkeAogICAgICAgICAgICAgIGNoaWxkTm9kZS55ICs9IGR5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCgogICAgICAgICAgLy8g5pu05paw5Zu+6KGoCiAgICAgICAgICBfdGhpcy5ncmFwaEluc3RhbmNlLnNldE9wdGlvbih7CiAgICAgICAgICAgIHNlcmllczogW3sKICAgICAgICAgICAgICBkYXRhOiBhbGxOb2RlcwogICAgICAgICAgICB9XQogICAgICAgICAgfSwgZmFsc2UpCiAgICAgICAgfQoKICAgICAgICAvLyDlpoLmnpzmmK/lrZDoioLngrnooqvmi5bliqjvvIzmo4Dmn6XlroPmmK/lkKblsZ7kuo7lpJrkuKrniLboioLngrkKICAgICAgICBlbHNlIGlmIChjdXJyZW50Tm9kZS50eXBlICE9PSAnbW92aWUnICYmIF90aGlzLm5vZGVQb3NpdGlvbnMuaGFzKGN1cnJlbnROb2RlLmlkKSkgewogICAgICAgICAgY29uc3QgcGFyZW50TW92aWVJZHMgPSBBcnJheS5mcm9tKF90aGlzLm5vZGVQb3NpdGlvbnMuZ2V0KGN1cnJlbnROb2RlLmlkKSkKICAgICAgICAgIGNvbnN0IGdyYXBoT3B0aW9uID0gX3RoaXMuZ3JhcGhJbnN0YW5jZS5nZXRPcHRpb24oKQogICAgICAgICAgY29uc3QgYWxsTm9kZXMgPSBncmFwaE9wdGlvbi5zZXJpZXNbMF0uZGF0YQoKICAgICAgICAgIC8vIOaJvuWIsOWvueW6lOeahOeItueUteW9seiKgueCuQogICAgICAgICAgcGFyZW50TW92aWVJZHMuZm9yRWFjaChwYXJlbnRJZCA9PiB7CiAgICAgICAgICAgIGNvbnN0IHBhcmVudE5vZGUgPSBhbGxOb2Rlcy5maW5kKG4gPT4gbi5pZCA9PT0gcGFyZW50SWQgJiYgbi50eXBlID09PSAnbW92aWUnKQogICAgICAgICAgICBpZiAocGFyZW50Tm9kZSkgewogICAgICAgICAgICAgIC8vIOiuoeeul+eItuiKgueCueeahOaWsOS9jee9ru+8iOS/neaMgeebuOWvueS9jee9ruS4jeWPmO+8iQogICAgICAgICAgICAgIGNvbnN0IHJlbGF0aXZlWCA9IGN1cnJlbnROb2RlLnggLSBfdGhpcy5kcmFnU3RhcnRQb3MueAogICAgICAgICAgICAgIGNvbnN0IHJlbGF0aXZlWSA9IGN1cnJlbnROb2RlLnkgLSBfdGhpcy5kcmFnU3RhcnRQb3MueQogICAgICAgICAgICAgIHBhcmVudE5vZGUueCArPSByZWxhdGl2ZVgKICAgICAgICAgICAgICBwYXJlbnROb2RlLnkgKz0gcmVsYXRpdmVZCgogICAgICAgICAgICAgIC8vIOenu+WKqOivpeeItuiKgueCueeahOWFtuS7luWtkOiKgueCuQogICAgICAgICAgICAgIGlmIChfdGhpcy5jb3JlTW92aWVNYXAuaGFzKHBhcmVudElkKSkgewogICAgICAgICAgICAgICAgY29uc3Qgc2libGluZ0lkcyA9IF90aGlzLmNvcmVNb3ZpZU1hcC5nZXQocGFyZW50SWQpCiAgICAgICAgICAgICAgICBzaWJsaW5nSWRzLmZvckVhY2goc2libGluZ0lkID0+IHsKICAgICAgICAgICAgICAgICAgaWYgKHNpYmxpbmdJZCAhPT0gY3VycmVudE5vZGUuaWQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzaWJsaW5nTm9kZSA9IGFsbE5vZGVzLmZpbmQobiA9PiBuLmlkID09PSBzaWJsaW5nSWQpCiAgICAgICAgICAgICAgICAgICAgaWYgKHNpYmxpbmdOb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICBzaWJsaW5nTm9kZS54ICs9IHJlbGF0aXZlWAogICAgICAgICAgICAgICAgICAgICAgc2libGluZ05vZGUueSArPSByZWxhdGl2ZVkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KQoKICAgICAgICAgIC8vIOabtOaWsOWbvuihqAogICAgICAgICAgX3RoaXMuZ3JhcGhJbnN0YW5jZS5zZXRPcHRpb24oewogICAgICAgICAgICBzZXJpZXM6IFt7CiAgICAgICAgICAgICAgZGF0YTogYWxsTm9kZXMKICAgICAgICAgICAgfV0KICAgICAgICAgIH0sIGZhbHNlKQogICAgICAgIH0KCiAgICAgICAgLy8g5pu05paw6LW35aeL5L2N572uCiAgICAgICAgX3RoaXMuZHJhZ1N0YXJ0UG9zID0gewogICAgICAgICAgeDogY3VycmVudE5vZGUueCwKICAgICAgICAgIHk6IGN1cnJlbnROb2RlLnkKICAgICAgICB9CiAgICAgIH0pCgogICAgICAvLyDmi5bliqjnu5PmnZ/kuovku7YKICAgICAgdGhpcy5ncmFwaEluc3RhbmNlLm9uKCdkcmFnZW5kJywgZnVuY3Rpb24oKSB7CiAgICAgICAgX3RoaXMuaXNEcmFnZ2luZyA9IGZhbHNlCiAgICAgICAgX3RoaXMuZHJhZ2dlZE5vZGUgPSBudWxsCiAgICAgICAgX3RoaXMuZHJhZ1N0YXJ0UG9zID0geyB4OiAwLCB5OiAwIH0KICAgICAgfSkKCiAgICAgIC8vIOeCueWHu+iKgueCueS6i+S7tgogICAgICB0aGlzLmdyYXBoSW5zdGFuY2Uub24oJ2NsaWNrJywgcGFyYW1zID0+IHsKICAgICAgICBpZiAocGFyYW1zLmRhdGFUeXBlID09PSAnbm9kZScpIHsKICAgICAgICAgIF90aGlzLnNob3dOb2RlRGV0YWlsKHBhcmFtcy5kYXRhKQogICAgICAgIH0KICAgICAgfSkKCiAgICAgIC8vIOehruS/neWbvuihqOmAguW6lOWuueWZqOWkp+WwjwogICAgICB0aGlzLmdyYXBoSW5zdGFuY2UucmVzaXplKCkKICAgIH0sCgogICAgc2hvd05vZGVEZXRhaWwobm9kZU1vZGVsKSB7CiAgICAgIGlmIChub2RlTW9kZWwuY2F0ZWdvcnkgIT09IDApIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmluZm8oYCR7bm9kZU1vZGVsLm5hbWV9IHwgJHtbJ+eUteW9sScsJ+WvvOa8lCcsJ+a8lOWRmCcsJ+WcsOWMuicsJ+exu+WeiyddW25vZGVNb2RlbC5jYXRlZ29yeV0gfHwgJ+acquefpSd9YCkKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgLy8g6I635Y+W55S15b2x6K+m5oOF5L+h5oGvCiAgICAgIGNvbnN0IGRpcmVjdG9ycyA9IHRoaXMuZ3JhcGhEYXRhLmVkZ2VzCiAgICAgICAgICAuZmlsdGVyKGVkZ2UgPT4gZWRnZS5zb3VyY2UgPT09IG5vZGVNb2RlbC5pZCAmJiBlZGdlLmxhYmVsID09PSAn5a+85ryUJykKICAgICAgICAgIC5tYXAoZWRnZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHROb2RlID0gdGhpcy5ncmFwaERhdGEubm9kZXMuZmluZChuID0+IG4uaWQgPT09IGVkZ2UudGFyZ2V0KQogICAgICAgICAgICByZXR1cm4gdE5vZGUgPyB0Tm9kZS5uYW1lIDogbnVsbAogICAgICAgICAgfSkKICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbikKCiAgICAgIGNvbnN0IGFjdG9ycyA9IHRoaXMuZ3JhcGhEYXRhLmVkZ2VzCiAgICAgICAgICAuZmlsdGVyKGVkZ2UgPT4gZWRnZS5zb3VyY2UgPT09IG5vZGVNb2RlbC5pZCAmJiBlZGdlLmxhYmVsID09PSAn5Li75ryUJykKICAgICAgICAgIC5tYXAoZWRnZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHROb2RlID0gdGhpcy5ncmFwaERhdGEubm9kZXMuZmluZChuID0+IG4uaWQgPT09IGVkZ2UudGFyZ2V0KQogICAgICAgICAgICByZXR1cm4gdE5vZGUgPyB0Tm9kZS5uYW1lIDogbnVsbAogICAgICAgICAgfSkKICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbikKCiAgICAgIGNvbnN0IHJlZ2lvbkVkZ2UgPSB0aGlzLmdyYXBoRGF0YS5lZGdlcy5maW5kKGVkZ2UgPT4gZWRnZS5zb3VyY2UgPT09IG5vZGVNb2RlbC5pZCAmJiBlZGdlLmxhYmVsID09PSAn5Zyw5Yy6JykKICAgICAgY29uc3QgZ2VucmVFZGdlID0gdGhpcy5ncmFwaERhdGEuZWRnZXMuZmluZChlZGdlID0+IGVkZ2Uuc291cmNlID09PSBub2RlTW9kZWwuaWQgJiYgZWRnZS5sYWJlbCA9PT0gJ+exu+WeiycpCgogICAgICBsZXQgcmVnaW9uID0gJycKICAgICAgbGV0IGdlbnJlID0gJycKCiAgICAgIGlmIChyZWdpb25FZGdlKSB7CiAgICAgICAgY29uc3QgdE5vZGUgPSB0aGlzLmdyYXBoRGF0YS5ub2Rlcy5maW5kKG4gPT4gbi5pZCA9PT0gcmVnaW9uRWRnZS50YXJnZXQpCiAgICAgICAgcmVnaW9uID0gdE5vZGUgPyB0Tm9kZS5uYW1lIDogJycKICAgICAgfQoKICAgICAgaWYgKGdlbnJlRWRnZSkgewogICAgICAgIGNvbnN0IHROb2RlID0gdGhpcy5ncmFwaERhdGEubm9kZXMuZmluZChuID0+IG4uaWQgPT09IGdlbnJlRWRnZS50YXJnZXQpCiAgICAgICAgZ2VucmUgPSB0Tm9kZSA/IHROb2RlLm5hbWUgOiAnJwogICAgICB9CgogICAgICB0aGlzLm5vZGVEZXRhaWwgPSB7CiAgICAgICAgLi4ubm9kZU1vZGVsLAogICAgICAgIGRpcmVjdG9yczogZGlyZWN0b3JzLmpvaW4oJ+OAgScpLAogICAgICAgIGFjdG9yczogYWN0b3JzLmpvaW4oJ+OAgScpLAogICAgICAgIHJlZ2lvbiwKICAgICAgICBnZW5yZQogICAgICB9CiAgICAgIHRoaXMuc2hvd0RldGFpbERpYWxvZyA9IHRydWUKICAgIH0sCgogICAgZmlsdGVyTm9kZXMoKSB7CiAgICAgIHRoaXMucmVuZGVyR3JhcGgoKQogICAgfSwKCiAgICBzZWFyY2hOb2RlcygpIHsKICAgICAgdGhpcy5yZW5kZXJHcmFwaCgpCiAgICB9LAoKICAgIHJlc2V0R3JhcGgoKSB7CiAgICAgIHRoaXMuc2VsZWN0ZWROb2RlVHlwZSA9ICdhbGwnCiAgICAgIHRoaXMuc2VhcmNoS2V5d29yZCA9ICcnCiAgICAgIHRoaXMubG9jYWxNb3ZpZUNvdW50ID0gMTAKICAgICAgdGhpcy5mZXRjaEdyYXBoRGF0YSgpCiAgICB9LAoKICAgIG9uTW92aWVDb3VudENoYW5nZSgpIHsKICAgICAgdGhpcy5mZXRjaEdyYXBoRGF0YSgpCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["KnowledgeGraph.vue"],"names":[],"mappings":";AAmFA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"KnowledgeGraph.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"knowledge-graph-container\">\n    <!-- 筛选和搜索区域 -->\n    <div class=\"graph-controls\">\n      <el-select\n          v-model=\"selectedNodeType\"\n          placeholder=\"筛选节点类型\"\n          class=\"type-selector\"\n          @change=\"filterNodes\"\n      >\n        <el-option label=\"全部节点\" value=\"all\"></el-option>\n        <el-option label=\"电影\" value=\"movie\"></el-option>\n        <el-option label=\"导演\" value=\"director\"></el-option>\n        <el-option label=\"演员\" value=\"actor\"></el-option>\n        <el-option label=\"地区\" value=\"region\"></el-option>\n        <el-option label=\"类型\" value=\"genre\"></el-option>\n      </el-select>\n\n      <el-input\n          v-model=\"searchKeyword\"\n          placeholder=\"搜索节点名称\"\n          class=\"search-input\"\n          @keyup.enter=\"searchNodes\"\n      >\n        <el-button slot=\"append\" icon=\"el-icon-search\" @click=\"searchNodes\"></el-button>\n      </el-input>\n\n      <el-input-number\n          v-model=\"localMovieCount\"\n          placeholder=\"电影数量\"\n          class=\"movie-count-input\"\n          :min=\"1\"\n          :max=\"100\"\n          @change=\"onMovieCountChange\"\n      ></el-input-number>\n\n      <el-button type=\"primary\" @click=\"resetGraph\" class=\"reset-btn\">重置图谱</el-button>\n    </div>\n\n    <!-- 图谱渲染画布：使用绝对定位占满剩余空间 -->\n    <div ref=\"graphCanvas\" class=\"graph-canvas\"></div>\n\n    <!-- 电影详情弹窗 -->\n    <el-dialog\n        title=\"电影详情\"\n        :visible.sync=\"showDetailDialog\"\n        width=\"550px\"\n        append-to-body\n        destroy-on-close\n        custom-class=\"detail-dialog\"\n    >\n      <div class=\"detail-card\">\n        <div class=\"detail-header\">\n          <h3 class=\"movie-title\">{{ nodeDetail && nodeDetail.name || '' }}</h3>\n          <span class=\"movie-rating\">\n            <i class=\"el-icon-star-on\" style=\"color: #ffd700;\"></i>\n            {{ nodeDetail && nodeDetail.rating || '暂无' }}分\n          </span>\n        </div>\n        <div class=\"detail-content\">\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">导演：</span>\n            <span class=\"detail-value\">{{ nodeDetail && nodeDetail.directors || '无' }}</span>\n          </div>\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">演员：</span>\n            <span class=\"detail-value\">{{ nodeDetail && nodeDetail.actors || '无' }}</span>\n          </div>\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">地区：</span>\n            <span class=\"detail-value\">{{ nodeDetail && nodeDetail.region || '无' }}</span>\n          </div>\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">类型：</span>\n            <span class=\"detail-value\">{{ nodeDetail && nodeDetail.genre || '无' }}</span>\n          </div>\n        </div>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nconst echarts = require('echarts')\n\nexport default {\n  name: 'KnowledgeGraph',\n  props: {\n    movieCount: {\n      type: Number,\n      default: 10\n    },\n    currentUser: {\n      type: Object,\n      default: null\n    }\n  },\n  data() {\n    return {\n      graphInstance: null,\n      graphData: {\n        nodes: [],\n        edges: []\n      },\n      selectedNodeType: 'all',\n      searchKeyword: '',\n      showDetailDialog: false,\n      nodeDetail: null,\n      localMovieCount: 10,\n      coreMovieMap: new Map(), // 存储电影节点ID -> 子节点ID数组\n      nodePositions: new Map(), // 存储节点位置关系，用于跟随拖动\n      isDragging: false,\n      draggedNode: null,\n      dragStartPos: { x: 0, y: 0 }\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n      // 确保画布DOM完全加载后初始化\n      if (this.$refs.graphCanvas) {\n        this.initGraph()\n        this.localMovieCount = this.movieCount || 10\n        this.fetchGraphData()\n      } else {\n        this.$message.error('图谱画布DOM元素未找到！')\n      }\n    })\n  },\n  beforeDestroy() {\n    // 彻底销毁实例和事件，避免内存泄漏\n    if (this.graphInstance) {\n      this.graphInstance.off('dragstart')\n      this.graphInstance.off('drag')\n      this.graphInstance.off('dragend')\n      this.graphInstance.dispose()\n      this.graphInstance = null\n    }\n    window.removeEventListener('resize', this.handleResize)\n  },\n  methods: {\n    // 处理窗口大小变化\n    handleResize() {\n      if (this.graphInstance) {\n        this.graphInstance.resize()\n      }\n    },\n\n    initGraph() {\n      if (!echarts) {\n        this.$message.error('ECharts库加载失败！')\n        return\n      }\n      // 初始化ECharts实例\n      this.graphInstance = echarts.init(this.$refs.graphCanvas)\n\n      // 监听窗口大小变化\n      window.addEventListener('resize', this.handleResize)\n\n      // 绑定点击事件\n      this.graphInstance.on('click', (params) => {\n        if (params.dataType === 'node') {\n          this.showNodeDetail(params.data)\n        }\n      })\n    },\n\n    fetchGraphData() {\n      const apiUrl = `http://localhost:8081/api/kg/graph-data?movieCount=${this.localMovieCount}`\n      axios.get(apiUrl)\n          .then(res => {\n            if (res.status === 200) {\n              this.graphData = res.data.data || res.data\n              this.renderGraph()\n            }\n          })\n          .catch(err => {\n            this.$message.error('数据请求失败：' + err.message)\n            console.error('图谱数据请求失败：', err)\n          })\n    },\n\n    // 优化后的节点大小计算\n    getNodeSize(name, isCore) {\n      const fontSize = isCore ? 14 : 12\n      const baseSize = isCore ? 60 : 40\n      const length = name ? name.length : 0\n\n      // 根据文本长度调整大小\n      if (length <= 4) return baseSize\n      if (length <= 8) return baseSize * 1.2\n      return baseSize * 1.5\n    },\n\n    // 生成图谱数据（核心改进：建立节点跟随关系）\n    generateGraphData() {\n      let allNodes = [...this.graphData.nodes]\n      let allEdges = [...this.graphData.edges]\n\n      // 清空之前的映射\n      this.coreMovieMap.clear()\n      this.nodePositions.clear()\n\n      // 筛选逻辑\n      let filteredNodes = []\n      let filteredEdges = []\n\n      if (this.selectedNodeType === 'all') {\n        filteredNodes = allNodes\n        filteredEdges = allEdges\n      } else {\n        const targetNodes = allNodes.filter(node => node.type === this.selectedNodeType)\n        if (targetNodes.length === 0) {\n          return { nodes: [], edges: [], categories: this.getNodeCategories() }\n        }\n        const targetNodeIds = targetNodes.map(node => node.id)\n        const relatedEdges = allEdges.filter(edge =>\n            targetNodeIds.includes(edge.source) || targetNodeIds.includes(edge.target)\n        )\n        const relatedNodeIds = new Set()\n        relatedEdges.forEach(edge => {\n          relatedNodeIds.add(edge.source)\n          relatedNodeIds.add(edge.target)\n        })\n        filteredNodes = allNodes.filter(node => relatedNodeIds.has(node.id))\n        filteredEdges = relatedEdges\n      }\n\n      // 关键词搜索\n      if (this.searchKeyword) {\n        const keyword = this.searchKeyword.trim().toLowerCase()\n        filteredNodes = filteredNodes.filter(node => node.name && node.name.toLowerCase().includes(keyword))\n        const filteredNodeIds = filteredNodes.map(node => node.id)\n        filteredEdges = filteredEdges.filter(edge =>\n            filteredNodeIds.includes(edge.source) && filteredNodeIds.includes(edge.target)\n        )\n      }\n\n      const nodeCategories = this.getNodeCategories()\n\n      // 收集所有电影节点\n      const movieNodes = filteredNodes.filter(node => node.type === 'movie')\n\n      // 第一步：建立电影节点与子节点的映射关系\n      movieNodes.forEach(movieNode => {\n        if (!movieNode.id) return\n\n        // 找到与当前电影节点相关的边\n        const movieEdges = filteredEdges.filter(edge =>\n            edge.source === movieNode.id || edge.target === movieNode.id\n        )\n\n        // 收集所有子节点ID\n        const childNodeIds = []\n        movieEdges.forEach(edge => {\n          const childId = edge.source === movieNode.id ? edge.target : edge.source\n          // 排除电影节点自身\n          const childNode = filteredNodes.find(n => n.id === childId && n.type !== 'movie')\n          if (childNode) {\n            childNodeIds.push(childId)\n          }\n        })\n\n        // 存储映射关系\n        this.coreMovieMap.set(movieNode.id, childNodeIds)\n\n        // 为每个子节点存储其父电影节点的位置关系\n        childNodeIds.forEach(childId => {\n          if (!this.nodePositions.has(childId)) {\n            this.nodePositions.set(childId, new Set())\n          }\n          this.nodePositions.get(childId).add(movieNode.id)\n        })\n      })\n\n      // 第二步：计算布局\n      const nodes = []\n      const edges = []\n\n      // 计算画布中心点\n      const canvasWidth = this.$refs.graphCanvas.offsetWidth\n      const canvasHeight = this.$refs.graphCanvas.offsetHeight\n      const centerX = canvasWidth / 2\n      const centerY = canvasHeight / 2\n\n      // 电影节点布局参数\n      const movieSpacingX = canvasWidth * 0.8 / Math.max(1, Math.ceil(Math.sqrt(movieNodes.length)))\n      const movieSpacingY = canvasHeight * 0.8 / Math.max(1, Math.ceil(Math.sqrt(movieNodes.length)))\n\n      // 处理电影节点\n      movieNodes.forEach((movieNode, index) => {\n        if (!movieNode.id) return\n\n        // 计算电影节点位置（网格布局）\n        const row = Math.floor(index / Math.ceil(Math.sqrt(movieNodes.length)))\n        const col = index % Math.ceil(Math.sqrt(movieNodes.length))\n        const movieX = centerX - (movieSpacingX * (Math.ceil(Math.sqrt(movieNodes.length)) - 1) / 2) + col * movieSpacingX\n        const movieY = centerY - (movieSpacingY * (Math.ceil(Math.sqrt(movieNodes.length)) - 1) / 2) + row * movieSpacingY\n\n        // 添加电影节点\n        nodes.push({\n          id: movieNode.id,\n          name: movieNode.name,\n          category: 0,\n          x: movieX,\n          y: movieY,\n          symbolSize: this.getNodeSize(movieNode.name, true),\n          itemStyle: nodeCategories[0].itemStyle,\n          label: {\n            show: true,\n            fontSize: 12,\n            fontWeight: 'bold',\n            color: '#000',\n            overflow: 'break',\n            lineHeight: 16\n          },\n          draggable: true,\n          type: 'movie'\n        })\n\n        // 添加电影节点的子节点\n        const childNodeIds = this.coreMovieMap.get(movieNode.id) || []\n        childNodeIds.forEach((childId, childIndex) => {\n          const childNode = filteredNodes.find(n => n.id === childId)\n          if (!childNode) return\n\n          // 检查是否已经添加过该子节点（避免重复）\n          if (nodes.find(n => n.id === childId)) return\n\n          // 计算子节点位置（围绕电影节点）\n          const angle = (childIndex / childNodeIds.length) * Math.PI * 2\n          const radius = Math.min(movieSpacingX, movieSpacingY) * 0.6\n          const childX = movieX + radius * Math.cos(angle)\n          const childY = movieY + radius * Math.sin(angle)\n\n          // 确定节点类型索引\n          const catIdx = nodeCategories.findIndex(c => c.name === childNode.type)\n\n          nodes.push({\n            id: childNode.id,\n            name: childNode.name,\n            category: catIdx >= 0 ? catIdx : 4,\n            x: childX,\n            y: childY,\n            symbolSize: this.getNodeSize(childNode.name, false),\n            itemStyle: nodeCategories[catIdx >= 0 ? catIdx : 4].itemStyle,\n            label: {\n              show: true,\n              fontSize: 10,\n              color: '#000',\n              overflow: 'break',\n              lineHeight: 14\n            },\n            draggable: true,\n            type: childNode.type\n          })\n        })\n      })\n\n      // 第三步：添加边\n      filteredEdges.forEach(edge => {\n        // 确保边的两个节点都存在\n        if (nodes.find(n => n.id === edge.source) && nodes.find(n => n.id === edge.target)) {\n          edges.push({\n            source: edge.source,\n            target: edge.target,\n            label: {\n              show: true,\n              formatter: edge.label,\n              fontSize: 10,\n              color: '#666',\n              position: 'middle'\n            },\n            lineStyle: {\n              width: 1.5,\n              color: '#B0C4DE',\n              type: 'solid',\n              opacity: 0.8\n            }\n          })\n        }\n      })\n\n      return {\n        nodes: nodes,\n        edges: edges,\n        categories: nodeCategories\n      }\n    },\n\n    getNodeCategories() {\n      return [\n        { name: 'movie', itemStyle: { color: '#8A2BE2', borderWidth: 2, borderColor: '#4B0082' } },\n        { name: 'director', itemStyle: { color: '#FF4500', borderWidth: 1, borderColor: '#FF6347' } },\n        { name: 'actor', itemStyle: { color: '#FF6347', borderWidth: 1, borderColor: '#FF4500' } },\n        { name: 'region', itemStyle: { color: '#FFD700', borderWidth: 1, borderColor: '#FFA500' } },\n        { name: 'genre', itemStyle: { color: '#32CD32', borderWidth: 1, borderColor: '#228B22' } }\n      ]\n    },\n\n    renderGraph() {\n      if (!this.graphInstance) return\n\n      const graphData = this.generateGraphData()\n      const _this = this\n\n      // 计算画布大小\n      const containerWidth = this.$refs.graphCanvas.offsetWidth\n      const containerHeight = this.$refs.graphCanvas.offsetHeight\n\n      // ECharts配置\n      const option = {\n        backgroundColor: '#FFFFFF',\n        tooltip: {\n          trigger: 'item',\n          backgroundColor: 'rgba(255,255,255,0.95)',\n          borderColor: '#E5E5E5',\n          borderWidth: 1,\n          borderRadius: 6,\n          padding: [8, 12],\n          textStyle: { color: '#333', fontSize: 12 },\n          formatter: params => {\n            if (params.dataType === 'node') {\n              const types = ['电影','导演','演员','地区','类型']\n              return `${params.name}<br/>类型：${types[params.data.category] || '未知'}`\n            }\n            return params.dataType === 'edge' ? `关系：${params.data.label.formatter}` : params.name\n          }\n        },\n        legend: {\n          show: true,\n          data: [\n            {name:'电影', icon: 'circle', textStyle: {color: '#8A2BE2'}},\n            {name:'导演', icon: 'circle', textStyle: {color: '#FF4500'}},\n            {name:'演员', icon: 'circle', textStyle: {color: '#FF6347'}},\n            {name:'地区', icon: 'circle', textStyle: {color: '#FFD700'}},\n            {name:'类型', icon: 'circle', textStyle: {color: '#32CD32'}}\n          ],\n          top: 10,\n          left: 'center',\n          itemGap: 15,\n          textStyle: { fontSize: 12, color: '#000' },\n          icon: 'circle'\n        },\n        series: [\n          {\n            type: 'graph',\n            layout: 'none',\n            roam: true,\n            zoom: 1,\n            center: ['50%', '50%'],\n            draggable: true,\n            symbol: 'circle',\n            symbolSize: 40,\n            edgeSymbol: ['circle', 'arrow'],\n            edgeSymbolSize: [4, 10],\n            cursor: 'move',\n            label: {\n              show: true,\n              position: 'inside',\n              color: '#000',\n              fontSize: 10,\n              fontWeight: 'normal'\n            },\n            edgeLabel: {\n              show: true,\n              position: 'middle',\n              fontSize: 10\n            },\n            data: graphData.nodes,\n            links: graphData.edges,\n            categories: graphData.categories,\n            lineStyle: {\n              color: 'source',\n              width: 1.5,\n              curveness: 0.2,\n              opacity: 0.8\n            },\n            emphasis: {\n              focus: 'adjacency',\n              lineStyle: {\n                width: 2,\n                opacity: 1\n              }\n            }\n          }\n        ]\n      }\n\n      // 清空并设置新配置\n      this.graphInstance.clear()\n      this.graphInstance.setOption(option, true)\n\n      // 移除旧的事件监听器\n      this.graphInstance.off('dragstart')\n      this.graphInstance.off('drag')\n      this.graphInstance.off('dragend')\n\n      // 拖动开始事件\n      this.graphInstance.on('dragstart', function(params) {\n        if (params.dataType !== 'node') return\n\n        _this.isDragging = true\n        _this.draggedNode = params.data\n        _this.dragStartPos = {\n          x: params.data.x,\n          y: params.data.y\n        }\n      })\n\n      // 拖动事件 - 核心：子节点跟随父节点\n      this.graphInstance.on('drag', function(params) {\n        if (!_this.isDragging || params.dataType !== 'node') return\n\n        const currentNode = params.data\n        const dx = currentNode.x - _this.dragStartPos.x\n        const dy = currentNode.y - _this.dragStartPos.y\n\n        // 如果是电影节点被拖动，移动所有子节点\n        if (currentNode.type === 'movie' && _this.coreMovieMap.has(currentNode.id)) {\n          const childNodeIds = _this.coreMovieMap.get(currentNode.id)\n          const graphOption = _this.graphInstance.getOption()\n          const allNodes = graphOption.series[0].data\n\n          // 更新所有子节点的位置\n          childNodeIds.forEach(childId => {\n            const childNode = allNodes.find(n => n.id === childId)\n            if (childNode) {\n              childNode.x += dx\n              childNode.y += dy\n            }\n          })\n\n          // 更新图表\n          _this.graphInstance.setOption({\n            series: [{\n              data: allNodes\n            }]\n          }, false)\n        }\n\n        // 如果是子节点被拖动，检查它是否属于多个父节点\n        else if (currentNode.type !== 'movie' && _this.nodePositions.has(currentNode.id)) {\n          const parentMovieIds = Array.from(_this.nodePositions.get(currentNode.id))\n          const graphOption = _this.graphInstance.getOption()\n          const allNodes = graphOption.series[0].data\n\n          // 找到对应的父电影节点\n          parentMovieIds.forEach(parentId => {\n            const parentNode = allNodes.find(n => n.id === parentId && n.type === 'movie')\n            if (parentNode) {\n              // 计算父节点的新位置（保持相对位置不变）\n              const relativeX = currentNode.x - _this.dragStartPos.x\n              const relativeY = currentNode.y - _this.dragStartPos.y\n              parentNode.x += relativeX\n              parentNode.y += relativeY\n\n              // 移动该父节点的其他子节点\n              if (_this.coreMovieMap.has(parentId)) {\n                const siblingIds = _this.coreMovieMap.get(parentId)\n                siblingIds.forEach(siblingId => {\n                  if (siblingId !== currentNode.id) {\n                    const siblingNode = allNodes.find(n => n.id === siblingId)\n                    if (siblingNode) {\n                      siblingNode.x += relativeX\n                      siblingNode.y += relativeY\n                    }\n                  }\n                })\n              }\n            }\n          })\n\n          // 更新图表\n          _this.graphInstance.setOption({\n            series: [{\n              data: allNodes\n            }]\n          }, false)\n        }\n\n        // 更新起始位置\n        _this.dragStartPos = {\n          x: currentNode.x,\n          y: currentNode.y\n        }\n      })\n\n      // 拖动结束事件\n      this.graphInstance.on('dragend', function() {\n        _this.isDragging = false\n        _this.draggedNode = null\n        _this.dragStartPos = { x: 0, y: 0 }\n      })\n\n      // 点击节点事件\n      this.graphInstance.on('click', params => {\n        if (params.dataType === 'node') {\n          _this.showNodeDetail(params.data)\n        }\n      })\n\n      // 确保图表适应容器大小\n      this.graphInstance.resize()\n    },\n\n    showNodeDetail(nodeModel) {\n      if (nodeModel.category !== 0) {\n        this.$message.info(`${nodeModel.name} | ${['电影','导演','演员','地区','类型'][nodeModel.category] || '未知'}`)\n        return\n      }\n\n      // 获取电影详情信息\n      const directors = this.graphData.edges\n          .filter(edge => edge.source === nodeModel.id && edge.label === '导演')\n          .map(edge => {\n            const tNode = this.graphData.nodes.find(n => n.id === edge.target)\n            return tNode ? tNode.name : null\n          })\n          .filter(Boolean)\n\n      const actors = this.graphData.edges\n          .filter(edge => edge.source === nodeModel.id && edge.label === '主演')\n          .map(edge => {\n            const tNode = this.graphData.nodes.find(n => n.id === edge.target)\n            return tNode ? tNode.name : null\n          })\n          .filter(Boolean)\n\n      const regionEdge = this.graphData.edges.find(edge => edge.source === nodeModel.id && edge.label === '地区')\n      const genreEdge = this.graphData.edges.find(edge => edge.source === nodeModel.id && edge.label === '类型')\n\n      let region = ''\n      let genre = ''\n\n      if (regionEdge) {\n        const tNode = this.graphData.nodes.find(n => n.id === regionEdge.target)\n        region = tNode ? tNode.name : ''\n      }\n\n      if (genreEdge) {\n        const tNode = this.graphData.nodes.find(n => n.id === genreEdge.target)\n        genre = tNode ? tNode.name : ''\n      }\n\n      this.nodeDetail = {\n        ...nodeModel,\n        directors: directors.join('、'),\n        actors: actors.join('、'),\n        region,\n        genre\n      }\n      this.showDetailDialog = true\n    },\n\n    filterNodes() {\n      this.renderGraph()\n    },\n\n    searchNodes() {\n      this.renderGraph()\n    },\n\n    resetGraph() {\n      this.selectedNodeType = 'all'\n      this.searchKeyword = ''\n      this.localMovieCount = 10\n      this.fetchGraphData()\n    },\n\n    onMovieCountChange() {\n      this.fetchGraphData()\n    }\n  }\n}\n</script>\n\n<style scoped>\n.knowledge-graph-container {\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  background-color: #FFFFFF;\n  overflow: hidden;\n  position: relative;\n  margin: 0;\n  padding: 0;\n}\n\n.graph-controls {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  padding: 12px 20px;\n  background-color: #F8F9FA;\n  border-bottom: 1px solid #E5E5E5;\n  flex-shrink: 0;\n  z-index: 10;\n  flex-wrap: wrap;\n}\n\n.type-selector {\n  width: 160px;\n  min-width: 160px;\n}\n\n.search-input {\n  flex: 1;\n  min-width: 200px;\n  max-width: 300px;\n}\n\n.movie-count-input {\n  width: 140px;\n  min-width: 140px;\n}\n\n.reset-btn {\n  background-color: #8A2BE2;\n  border-color: #8A2BE2;\n  color: white;\n  padding: 0 20px;\n}\n\n.reset-btn:hover {\n  background-color: #7B2BBE;\n  border-color: #7B2BBE;\n}\n\n/* 关键改进：画布占满剩余空间 */\n.graph-canvas {\n  flex: 1;\n  width: 100%;\n  min-height: 0; /* 防止flex项目溢出 */\n  overflow: hidden;\n  background-color: #FFFFFF;\n}\n\n/* 详情弹窗样式 */\n.detail-dialog {\n  border-radius: 8px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);\n}\n\n.detail-card {\n  padding: 24px;\n}\n\n.detail-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 20px;\n  padding-bottom: 16px;\n  border-bottom: 2px solid #F0F0F0;\n}\n\n.movie-title {\n  font-size: 20px;\n  font-weight: 700;\n  color: #333;\n  margin: 0;\n  line-height: 1.4;\n  flex: 1;\n}\n\n.movie-rating {\n  font-size: 14px;\n  color: #FFA500;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  font-weight: 600;\n  white-space: nowrap;\n  margin-left: 12px;\n}\n\n.detail-content {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n.detail-item {\n  display: flex;\n  align-items: flex-start;\n}\n\n.detail-label {\n  width: 60px;\n  font-size: 14px;\n  color: #666;\n  font-weight: 600;\n  flex-shrink: 0;\n}\n\n.detail-value {\n  flex: 1;\n  font-size: 14px;\n  color: #333;\n  line-height: 1.6;\n  word-break: break-word;\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n  .knowledge-graph-container {\n    height: 100vh;\n  }\n\n  .graph-controls {\n    padding: 10px 15px;\n    gap: 12px;\n  }\n\n  .type-selector,\n  .search-input,\n  .movie-count-input {\n    width: 100%;\n    min-width: unset;\n    max-width: unset;\n  }\n\n  .reset-btn {\n    width: 100%;\n    padding: 12px;\n  }\n\n  .graph-canvas {\n    height: calc(100vh - 160px);\n  }\n}\n\n@media (max-width: 480px) {\n  .graph-controls {\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .movie-title {\n    font-size: 18px;\n  }\n\n  .detail-label,\n  .detail-value {\n    font-size: 13px;\n  }\n}\n</style>"]}]}