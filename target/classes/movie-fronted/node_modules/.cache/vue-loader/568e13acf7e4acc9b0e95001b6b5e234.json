{"remainingRequest":"D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\src\\components\\KnowledgeGraph.vue?vue&type=style&index=0&id=a15744c0&scoped=true&lang=css","dependencies":[{"path":"D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\src\\components\\KnowledgeGraph.vue","mtime":1769411982949},{"path":"D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\node_modules\\css-loader\\dist\\cjs.js","mtime":1768463918291},{"path":"D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1768463918103},{"path":"D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\node_modules\\postcss-loader\\src\\index.js","mtime":1768463917867},{"path":"D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1768463919512},{"path":"D:\\ideaProject\\demo\\src\\main\\resources\\movie-fronted\\node_modules\\vue-loader\\lib\\index.js","mtime":1768463917873}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5rbm93bGVkZ2UtZ3JhcGgtY29udGFpbmVyIHsKICB3aWR0aDogMTAwdnc7CiAgaGVpZ2h0OiAxMDB2aDsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkZGRjsKICBvdmVyZmxvdzogaGlkZGVuOwogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBtYXJnaW46IDA7CiAgcGFkZGluZzogMDsKfQoKLmdyYXBoLWNvbnRyb2xzIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgZ2FwOiAxNnB4OwogIHBhZGRpbmc6IDEycHggMjBweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjRjhGOUZBOwogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjRTVFNUU1OwogIGZsZXgtc2hyaW5rOiAwOwogIHotaW5kZXg6IDEwOwogIGZsZXgtd3JhcDogd3JhcDsKfQoKLnR5cGUtc2VsZWN0b3IgewogIHdpZHRoOiAxNjBweDsKICBtaW4td2lkdGg6IDE2MHB4Owp9Cgouc2VhcmNoLWlucHV0IHsKICBmbGV4OiAxOwogIG1pbi13aWR0aDogMjAwcHg7CiAgbWF4LXdpZHRoOiAzMDBweDsKfQoKLm1vdmllLWNvdW50LWlucHV0IHsKICB3aWR0aDogMTQwcHg7CiAgbWluLXdpZHRoOiAxNDBweDsKfQoKLnJlc2V0LWJ0biB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzhBMkJFMjsKICBib3JkZXItY29sb3I6ICM4QTJCRTI7CiAgY29sb3I6IHdoaXRlOwogIHBhZGRpbmc6IDAgMjBweDsKfQoKLnJlc2V0LWJ0bjpob3ZlciB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzdCMkJCRTsKICBib3JkZXItY29sb3I6ICM3QjJCQkU7Cn0KCi8qIOWFs+mUruaUuei/m++8mueUu+W4g+WNoOa7oeWJqeS9meepuumXtCAqLwouZ3JhcGgtY2FudmFzIHsKICBmbGV4OiAxOwogIHdpZHRoOiAxMDAlOwogIG1pbi1oZWlnaHQ6IDA7IC8qIOmYsuatomZsZXjpobnnm67muqLlh7ogKi8KICBvdmVyZmxvdzogaGlkZGVuOwogIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7Cn0KCi8qIOivpuaDheW8ueeql+agt+W8jyAqLwouZGV0YWlsLWRpYWxvZyB7CiAgYm9yZGVyLXJhZGl1czogOHB4OwogIGJveC1zaGFkb3c6IDAgMTBweCAzMHB4IHJnYmEoMCwgMCwgMCwgMC4xKTsKfQoKLmRldGFpbC1jYXJkIHsKICBwYWRkaW5nOiAyNHB4Owp9CgouZGV0YWlsLWhlYWRlciB7CiAgZGlzcGxheTogZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgYWxpZ24taXRlbXM6IGZsZXgtc3RhcnQ7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKICBwYWRkaW5nLWJvdHRvbTogMTZweDsKICBib3JkZXItYm90dG9tOiAycHggc29saWQgI0YwRjBGMDsKfQoKLm1vdmllLXRpdGxlIHsKICBmb250LXNpemU6IDIwcHg7CiAgZm9udC13ZWlnaHQ6IDcwMDsKICBjb2xvcjogIzMzMzsKICBtYXJnaW46IDA7CiAgbGluZS1oZWlnaHQ6IDEuNDsKICBmbGV4OiAxOwp9CgoubW92aWUtcmF0aW5nIHsKICBmb250LXNpemU6IDE0cHg7CiAgY29sb3I6ICNGRkE1MDA7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGdhcDogNHB4OwogIGZvbnQtd2VpZ2h0OiA2MDA7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICBtYXJnaW4tbGVmdDogMTJweDsKfQoKLmRldGFpbC1jb250ZW50IHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgZ2FwOiAxNnB4Owp9CgouZGV0YWlsLWl0ZW0gewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGZsZXgtc3RhcnQ7Cn0KCi5kZXRhaWwtbGFiZWwgewogIHdpZHRoOiA2MHB4OwogIGZvbnQtc2l6ZTogMTRweDsKICBjb2xvcjogIzY2NjsKICBmb250LXdlaWdodDogNjAwOwogIGZsZXgtc2hyaW5rOiAwOwp9CgouZGV0YWlsLXZhbHVlIHsKICBmbGV4OiAxOwogIGZvbnQtc2l6ZTogMTRweDsKICBjb2xvcjogIzMzMzsKICBsaW5lLWhlaWdodDogMS42OwogIHdvcmQtYnJlYWs6IGJyZWFrLXdvcmQ7Cn0KCi8qIOWTjeW6lOW8j+iuvuiuoSAqLwpAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpIHsKICAua25vd2xlZGdlLWdyYXBoLWNvbnRhaW5lciB7CiAgICBoZWlnaHQ6IDEwMHZoOwogIH0KCiAgLmdyYXBoLWNvbnRyb2xzIHsKICAgIHBhZGRpbmc6IDEwcHggMTVweDsKICAgIGdhcDogMTJweDsKICB9CgogIC50eXBlLXNlbGVjdG9yLAogIC5zZWFyY2gtaW5wdXQsCiAgLm1vdmllLWNvdW50LWlucHV0IHsKICAgIHdpZHRoOiAxMDAlOwogICAgbWluLXdpZHRoOiB1bnNldDsKICAgIG1heC13aWR0aDogdW5zZXQ7CiAgfQoKICAucmVzZXQtYnRuIHsKICAgIHdpZHRoOiAxMDAlOwogICAgcGFkZGluZzogMTJweDsKICB9CgogIC5ncmFwaC1jYW52YXMgewogICAgaGVpZ2h0OiBjYWxjKDEwMHZoIC0gMTYwcHgpOwogIH0KfQoKQG1lZGlhIChtYXgtd2lkdGg6IDQ4MHB4KSB7CiAgLmdyYXBoLWNvbnRyb2xzIHsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBhbGlnbi1pdGVtczogc3RyZXRjaDsKICB9CgogIC5tb3ZpZS10aXRsZSB7CiAgICBmb250LXNpemU6IDE4cHg7CiAgfQoKICAuZGV0YWlsLWxhYmVsLAogIC5kZXRhaWwtdmFsdWUgewogICAgZm9udC1zaXplOiAxM3B4OwogIH0KfQo="},{"version":3,"sources":["KnowledgeGraph.vue"],"names":[],"mappings":";AAsqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"KnowledgeGraph.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"knowledge-graph-container\">\n    <!-- 筛选和搜索区域 -->\n    <div class=\"graph-controls\">\n      <el-select\n          v-model=\"selectedNodeType\"\n          placeholder=\"筛选节点类型\"\n          class=\"type-selector\"\n          @change=\"filterNodes\"\n      >\n        <el-option label=\"全部节点\" value=\"all\"></el-option>\n        <el-option label=\"电影\" value=\"movie\"></el-option>\n        <el-option label=\"导演\" value=\"director\"></el-option>\n        <el-option label=\"演员\" value=\"actor\"></el-option>\n        <el-option label=\"地区\" value=\"region\"></el-option>\n        <el-option label=\"类型\" value=\"genre\"></el-option>\n      </el-select>\n\n      <el-input\n          v-model=\"searchKeyword\"\n          placeholder=\"搜索节点名称\"\n          class=\"search-input\"\n          @keyup.enter=\"searchNodes\"\n      >\n        <el-button slot=\"append\" icon=\"el-icon-search\" @click=\"searchNodes\"></el-button>\n      </el-input>\n\n      <el-input-number\n          v-model=\"localMovieCount\"\n          placeholder=\"电影数量\"\n          class=\"movie-count-input\"\n          :min=\"1\"\n          :max=\"100\"\n          @change=\"onMovieCountChange\"\n      ></el-input-number>\n\n      <el-button type=\"primary\" @click=\"resetGraph\" class=\"reset-btn\">重置图谱</el-button>\n    </div>\n\n    <!-- 图谱渲染画布：使用绝对定位占满剩余空间 -->\n    <div ref=\"graphCanvas\" class=\"graph-canvas\"></div>\n\n    <!-- 电影详情弹窗 -->\n    <el-dialog\n        title=\"电影详情\"\n        :visible.sync=\"showDetailDialog\"\n        width=\"550px\"\n        append-to-body\n        destroy-on-close\n        custom-class=\"detail-dialog\"\n    >\n      <div class=\"detail-card\">\n        <div class=\"detail-header\">\n          <h3 class=\"movie-title\">{{ nodeDetail && nodeDetail.name || '' }}</h3>\n          <span class=\"movie-rating\">\n            <i class=\"el-icon-star-on\" style=\"color: #ffd700;\"></i>\n            {{ nodeDetail && nodeDetail.rating || '暂无' }}分\n          </span>\n        </div>\n        <div class=\"detail-content\">\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">导演：</span>\n            <span class=\"detail-value\">{{ nodeDetail && nodeDetail.directors || '无' }}</span>\n          </div>\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">演员：</span>\n            <span class=\"detail-value\">{{ nodeDetail && nodeDetail.actors || '无' }}</span>\n          </div>\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">地区：</span>\n            <span class=\"detail-value\">{{ nodeDetail && nodeDetail.region || '无' }}</span>\n          </div>\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">类型：</span>\n            <span class=\"detail-value\">{{ nodeDetail && nodeDetail.genre || '无' }}</span>\n          </div>\n        </div>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nconst echarts = require('echarts')\n\nexport default {\n  name: 'KnowledgeGraph',\n  props: {\n    movieCount: {\n      type: Number,\n      default: 10\n    },\n    currentUser: {\n      type: Object,\n      default: null\n    }\n  },\n  data() {\n    return {\n      graphInstance: null,\n      graphData: {\n        nodes: [],\n        edges: []\n      },\n      selectedNodeType: 'all',\n      searchKeyword: '',\n      showDetailDialog: false,\n      nodeDetail: null,\n      localMovieCount: 10,\n      coreMovieMap: new Map(), // 存储电影节点ID -> 子节点ID数组\n      nodePositions: new Map(), // 存储节点位置关系，用于跟随拖动\n      isDragging: false,\n      draggedNode: null,\n      dragStartPos: { x: 0, y: 0 }\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n      // 确保画布DOM完全加载后初始化\n      if (this.$refs.graphCanvas) {\n        this.initGraph()\n        this.localMovieCount = this.movieCount || 10\n        this.fetchGraphData()\n      } else {\n        this.$message.error('图谱画布DOM元素未找到！')\n      }\n    })\n  },\n  beforeDestroy() {\n    // 彻底销毁实例和事件，避免内存泄漏\n    if (this.graphInstance) {\n      this.graphInstance.off('dragstart')\n      this.graphInstance.off('drag')\n      this.graphInstance.off('dragend')\n      this.graphInstance.dispose()\n      this.graphInstance = null\n    }\n    window.removeEventListener('resize', this.handleResize)\n  },\n  methods: {\n    // 处理窗口大小变化\n    handleResize() {\n      if (this.graphInstance) {\n        this.graphInstance.resize()\n      }\n    },\n\n    initGraph() {\n      if (!echarts) {\n        this.$message.error('ECharts库加载失败！')\n        return\n      }\n      // 初始化ECharts实例\n      this.graphInstance = echarts.init(this.$refs.graphCanvas)\n\n      // 监听窗口大小变化\n      window.addEventListener('resize', this.handleResize)\n\n      // 绑定点击事件\n      this.graphInstance.on('click', (params) => {\n        if (params.dataType === 'node') {\n          this.showNodeDetail(params.data)\n        }\n      })\n    },\n\n    fetchGraphData() {\n      const apiUrl = `http://localhost:8081/api/kg/graph-data?movieCount=${this.localMovieCount}`\n      axios.get(apiUrl)\n          .then(res => {\n            if (res.status === 200) {\n              this.graphData = res.data.data || res.data\n              this.renderGraph()\n            }\n          })\n          .catch(err => {\n            this.$message.error('数据请求失败：' + err.message)\n            console.error('图谱数据请求失败：', err)\n          })\n    },\n\n    // 优化后的节点大小计算\n    getNodeSize(name, isCore) {\n      const fontSize = isCore ? 14 : 12\n      const baseSize = isCore ? 60 : 40\n      const length = name ? name.length : 0\n\n      // 根据文本长度调整大小\n      if (length <= 4) return baseSize\n      if (length <= 8) return baseSize * 1.2\n      return baseSize * 1.5\n    },\n\n    // 生成图谱数据（核心改进：建立节点跟随关系）\n    generateGraphData() {\n      let allNodes = [...this.graphData.nodes]\n      let allEdges = [...this.graphData.edges]\n\n      // 清空之前的映射\n      this.coreMovieMap.clear()\n      this.nodePositions.clear()\n\n      // 筛选逻辑\n      let filteredNodes = []\n      let filteredEdges = []\n\n      if (this.selectedNodeType === 'all') {\n        filteredNodes = allNodes\n        filteredEdges = allEdges\n      } else {\n        const targetNodes = allNodes.filter(node => node.type === this.selectedNodeType)\n        if (targetNodes.length === 0) {\n          return { nodes: [], edges: [], categories: this.getNodeCategories() }\n        }\n        const targetNodeIds = targetNodes.map(node => node.id)\n        const relatedEdges = allEdges.filter(edge =>\n            targetNodeIds.includes(edge.source) || targetNodeIds.includes(edge.target)\n        )\n        const relatedNodeIds = new Set()\n        relatedEdges.forEach(edge => {\n          relatedNodeIds.add(edge.source)\n          relatedNodeIds.add(edge.target)\n        })\n        filteredNodes = allNodes.filter(node => relatedNodeIds.has(node.id))\n        filteredEdges = relatedEdges\n      }\n\n      // 关键词搜索\n      if (this.searchKeyword) {\n        const keyword = this.searchKeyword.trim().toLowerCase()\n        filteredNodes = filteredNodes.filter(node => node.name && node.name.toLowerCase().includes(keyword))\n        const filteredNodeIds = filteredNodes.map(node => node.id)\n        filteredEdges = filteredEdges.filter(edge =>\n            filteredNodeIds.includes(edge.source) && filteredNodeIds.includes(edge.target)\n        )\n      }\n\n      const nodeCategories = this.getNodeCategories()\n\n      // 收集所有电影节点\n      const movieNodes = filteredNodes.filter(node => node.type === 'movie')\n\n      // 第一步：建立电影节点与子节点的映射关系\n      movieNodes.forEach(movieNode => {\n        if (!movieNode.id) return\n\n        // 找到与当前电影节点相关的边\n        const movieEdges = filteredEdges.filter(edge =>\n            edge.source === movieNode.id || edge.target === movieNode.id\n        )\n\n        // 收集所有子节点ID\n        const childNodeIds = []\n        movieEdges.forEach(edge => {\n          const childId = edge.source === movieNode.id ? edge.target : edge.source\n          // 排除电影节点自身\n          const childNode = filteredNodes.find(n => n.id === childId && n.type !== 'movie')\n          if (childNode) {\n            childNodeIds.push(childId)\n          }\n        })\n\n        // 存储映射关系\n        this.coreMovieMap.set(movieNode.id, childNodeIds)\n\n        // 为每个子节点存储其父电影节点的位置关系\n        childNodeIds.forEach(childId => {\n          if (!this.nodePositions.has(childId)) {\n            this.nodePositions.set(childId, new Set())\n          }\n          this.nodePositions.get(childId).add(movieNode.id)\n        })\n      })\n\n      // 第二步：计算布局\n      const nodes = []\n      const edges = []\n\n      // 计算画布中心点\n      const canvasWidth = this.$refs.graphCanvas.offsetWidth\n      const canvasHeight = this.$refs.graphCanvas.offsetHeight\n      const centerX = canvasWidth / 2\n      const centerY = canvasHeight / 2\n\n      // 电影节点布局参数\n      const movieSpacingX = canvasWidth * 0.8 / Math.max(1, Math.ceil(Math.sqrt(movieNodes.length)))\n      const movieSpacingY = canvasHeight * 0.8 / Math.max(1, Math.ceil(Math.sqrt(movieNodes.length)))\n\n      // 处理电影节点\n      movieNodes.forEach((movieNode, index) => {\n        if (!movieNode.id) return\n\n        // 计算电影节点位置（网格布局）\n        const row = Math.floor(index / Math.ceil(Math.sqrt(movieNodes.length)))\n        const col = index % Math.ceil(Math.sqrt(movieNodes.length))\n        const movieX = centerX - (movieSpacingX * (Math.ceil(Math.sqrt(movieNodes.length)) - 1) / 2) + col * movieSpacingX\n        const movieY = centerY - (movieSpacingY * (Math.ceil(Math.sqrt(movieNodes.length)) - 1) / 2) + row * movieSpacingY\n\n        // 添加电影节点\n        nodes.push({\n          id: movieNode.id,\n          name: movieNode.name,\n          category: 0,\n          x: movieX,\n          y: movieY,\n          symbolSize: this.getNodeSize(movieNode.name, true),\n          itemStyle: nodeCategories[0].itemStyle,\n          label: {\n            show: true,\n            fontSize: 12,\n            fontWeight: 'bold',\n            color: '#000',\n            overflow: 'break',\n            lineHeight: 16\n          },\n          draggable: true,\n          type: 'movie'\n        })\n\n        // 添加电影节点的子节点\n        const childNodeIds = this.coreMovieMap.get(movieNode.id) || []\n        childNodeIds.forEach((childId, childIndex) => {\n          const childNode = filteredNodes.find(n => n.id === childId)\n          if (!childNode) return\n\n          // 检查是否已经添加过该子节点（避免重复）\n          if (nodes.find(n => n.id === childId)) return\n\n          // 计算子节点位置（围绕电影节点）\n          const angle = (childIndex / childNodeIds.length) * Math.PI * 2\n          const radius = Math.min(movieSpacingX, movieSpacingY) * 0.6\n          const childX = movieX + radius * Math.cos(angle)\n          const childY = movieY + radius * Math.sin(angle)\n\n          // 确定节点类型索引\n          const catIdx = nodeCategories.findIndex(c => c.name === childNode.type)\n\n          nodes.push({\n            id: childNode.id,\n            name: childNode.name,\n            category: catIdx >= 0 ? catIdx : 4,\n            x: childX,\n            y: childY,\n            symbolSize: this.getNodeSize(childNode.name, false),\n            itemStyle: nodeCategories[catIdx >= 0 ? catIdx : 4].itemStyle,\n            label: {\n              show: true,\n              fontSize: 10,\n              color: '#000',\n              overflow: 'break',\n              lineHeight: 14\n            },\n            draggable: true,\n            type: childNode.type\n          })\n        })\n      })\n\n      // 第三步：添加边\n      filteredEdges.forEach(edge => {\n        // 确保边的两个节点都存在\n        if (nodes.find(n => n.id === edge.source) && nodes.find(n => n.id === edge.target)) {\n          edges.push({\n            source: edge.source,\n            target: edge.target,\n            label: {\n              show: true,\n              formatter: edge.label,\n              fontSize: 10,\n              color: '#666',\n              position: 'middle'\n            },\n            lineStyle: {\n              width: 1.5,\n              color: '#B0C4DE',\n              type: 'solid',\n              opacity: 0.8\n            }\n          })\n        }\n      })\n\n      return {\n        nodes: nodes,\n        edges: edges,\n        categories: nodeCategories\n      }\n    },\n\n    getNodeCategories() {\n      return [\n        { name: 'movie', itemStyle: { color: '#8A2BE2', borderWidth: 2, borderColor: '#4B0082' } },\n        { name: 'director', itemStyle: { color: '#FF4500', borderWidth: 1, borderColor: '#FF6347' } },\n        { name: 'actor', itemStyle: { color: '#FF6347', borderWidth: 1, borderColor: '#FF4500' } },\n        { name: 'region', itemStyle: { color: '#FFD700', borderWidth: 1, borderColor: '#FFA500' } },\n        { name: 'genre', itemStyle: { color: '#32CD32', borderWidth: 1, borderColor: '#228B22' } }\n      ]\n    },\n\n    renderGraph() {\n      if (!this.graphInstance) return\n\n      const graphData = this.generateGraphData()\n      const _this = this\n\n      // 计算画布大小\n      const containerWidth = this.$refs.graphCanvas.offsetWidth\n      const containerHeight = this.$refs.graphCanvas.offsetHeight\n\n      // ECharts配置\n      const option = {\n        backgroundColor: '#FFFFFF',\n        tooltip: {\n          trigger: 'item',\n          backgroundColor: 'rgba(255,255,255,0.95)',\n          borderColor: '#E5E5E5',\n          borderWidth: 1,\n          borderRadius: 6,\n          padding: [8, 12],\n          textStyle: { color: '#333', fontSize: 12 },\n          formatter: params => {\n            if (params.dataType === 'node') {\n              const types = ['电影','导演','演员','地区','类型']\n              return `${params.name}<br/>类型：${types[params.data.category] || '未知'}`\n            }\n            return params.dataType === 'edge' ? `关系：${params.data.label.formatter}` : params.name\n          }\n        },\n        legend: {\n          show: true,\n          data: [\n            {name:'电影', icon: 'circle', textStyle: {color: '#8A2BE2'}},\n            {name:'导演', icon: 'circle', textStyle: {color: '#FF4500'}},\n            {name:'演员', icon: 'circle', textStyle: {color: '#FF6347'}},\n            {name:'地区', icon: 'circle', textStyle: {color: '#FFD700'}},\n            {name:'类型', icon: 'circle', textStyle: {color: '#32CD32'}}\n          ],\n          top: 10,\n          left: 'center',\n          itemGap: 15,\n          textStyle: { fontSize: 12, color: '#000' },\n          icon: 'circle'\n        },\n        series: [\n          {\n            type: 'graph',\n            layout: 'none',\n            roam: true,\n            zoom: 1,\n            center: ['50%', '50%'],\n            draggable: true,\n            symbol: 'circle',\n            symbolSize: 40,\n            edgeSymbol: ['circle', 'arrow'],\n            edgeSymbolSize: [4, 10],\n            cursor: 'move',\n            label: {\n              show: true,\n              position: 'inside',\n              color: '#000',\n              fontSize: 10,\n              fontWeight: 'normal'\n            },\n            edgeLabel: {\n              show: true,\n              position: 'middle',\n              fontSize: 10\n            },\n            data: graphData.nodes,\n            links: graphData.edges,\n            categories: graphData.categories,\n            lineStyle: {\n              color: 'source',\n              width: 1.5,\n              curveness: 0.2,\n              opacity: 0.8\n            },\n            emphasis: {\n              focus: 'adjacency',\n              lineStyle: {\n                width: 2,\n                opacity: 1\n              }\n            }\n          }\n        ]\n      }\n\n      // 清空并设置新配置\n      this.graphInstance.clear()\n      this.graphInstance.setOption(option, true)\n\n      // 移除旧的事件监听器\n      this.graphInstance.off('dragstart')\n      this.graphInstance.off('drag')\n      this.graphInstance.off('dragend')\n\n      // 拖动开始事件\n      this.graphInstance.on('dragstart', function(params) {\n        if (params.dataType !== 'node') return\n\n        _this.isDragging = true\n        _this.draggedNode = params.data\n        _this.dragStartPos = {\n          x: params.data.x,\n          y: params.data.y\n        }\n      })\n\n      // 拖动事件 - 核心：子节点跟随父节点\n      this.graphInstance.on('drag', function(params) {\n        if (!_this.isDragging || params.dataType !== 'node') return\n\n        const currentNode = params.data\n        const dx = currentNode.x - _this.dragStartPos.x\n        const dy = currentNode.y - _this.dragStartPos.y\n\n        // 如果是电影节点被拖动，移动所有子节点\n        if (currentNode.type === 'movie' && _this.coreMovieMap.has(currentNode.id)) {\n          const childNodeIds = _this.coreMovieMap.get(currentNode.id)\n          const graphOption = _this.graphInstance.getOption()\n          const allNodes = graphOption.series[0].data\n\n          // 更新所有子节点的位置\n          childNodeIds.forEach(childId => {\n            const childNode = allNodes.find(n => n.id === childId)\n            if (childNode) {\n              childNode.x += dx\n              childNode.y += dy\n            }\n          })\n\n          // 更新图表\n          _this.graphInstance.setOption({\n            series: [{\n              data: allNodes\n            }]\n          }, false)\n        }\n\n        // 如果是子节点被拖动，检查它是否属于多个父节点\n        else if (currentNode.type !== 'movie' && _this.nodePositions.has(currentNode.id)) {\n          const parentMovieIds = Array.from(_this.nodePositions.get(currentNode.id))\n          const graphOption = _this.graphInstance.getOption()\n          const allNodes = graphOption.series[0].data\n\n          // 找到对应的父电影节点\n          parentMovieIds.forEach(parentId => {\n            const parentNode = allNodes.find(n => n.id === parentId && n.type === 'movie')\n            if (parentNode) {\n              // 计算父节点的新位置（保持相对位置不变）\n              const relativeX = currentNode.x - _this.dragStartPos.x\n              const relativeY = currentNode.y - _this.dragStartPos.y\n              parentNode.x += relativeX\n              parentNode.y += relativeY\n\n              // 移动该父节点的其他子节点\n              if (_this.coreMovieMap.has(parentId)) {\n                const siblingIds = _this.coreMovieMap.get(parentId)\n                siblingIds.forEach(siblingId => {\n                  if (siblingId !== currentNode.id) {\n                    const siblingNode = allNodes.find(n => n.id === siblingId)\n                    if (siblingNode) {\n                      siblingNode.x += relativeX\n                      siblingNode.y += relativeY\n                    }\n                  }\n                })\n              }\n            }\n          })\n\n          // 更新图表\n          _this.graphInstance.setOption({\n            series: [{\n              data: allNodes\n            }]\n          }, false)\n        }\n\n        // 更新起始位置\n        _this.dragStartPos = {\n          x: currentNode.x,\n          y: currentNode.y\n        }\n      })\n\n      // 拖动结束事件\n      this.graphInstance.on('dragend', function() {\n        _this.isDragging = false\n        _this.draggedNode = null\n        _this.dragStartPos = { x: 0, y: 0 }\n      })\n\n      // 点击节点事件\n      this.graphInstance.on('click', params => {\n        if (params.dataType === 'node') {\n          _this.showNodeDetail(params.data)\n        }\n      })\n\n      // 确保图表适应容器大小\n      this.graphInstance.resize()\n    },\n\n    showNodeDetail(nodeModel) {\n      if (nodeModel.category !== 0) {\n        this.$message.info(`${nodeModel.name} | ${['电影','导演','演员','地区','类型'][nodeModel.category] || '未知'}`)\n        return\n      }\n\n      // 获取电影详情信息\n      const directors = this.graphData.edges\n          .filter(edge => edge.source === nodeModel.id && edge.label === '导演')\n          .map(edge => {\n            const tNode = this.graphData.nodes.find(n => n.id === edge.target)\n            return tNode ? tNode.name : null\n          })\n          .filter(Boolean)\n\n      const actors = this.graphData.edges\n          .filter(edge => edge.source === nodeModel.id && edge.label === '主演')\n          .map(edge => {\n            const tNode = this.graphData.nodes.find(n => n.id === edge.target)\n            return tNode ? tNode.name : null\n          })\n          .filter(Boolean)\n\n      const regionEdge = this.graphData.edges.find(edge => edge.source === nodeModel.id && edge.label === '地区')\n      const genreEdge = this.graphData.edges.find(edge => edge.source === nodeModel.id && edge.label === '类型')\n\n      let region = ''\n      let genre = ''\n\n      if (regionEdge) {\n        const tNode = this.graphData.nodes.find(n => n.id === regionEdge.target)\n        region = tNode ? tNode.name : ''\n      }\n\n      if (genreEdge) {\n        const tNode = this.graphData.nodes.find(n => n.id === genreEdge.target)\n        genre = tNode ? tNode.name : ''\n      }\n\n      this.nodeDetail = {\n        ...nodeModel,\n        directors: directors.join('、'),\n        actors: actors.join('、'),\n        region,\n        genre\n      }\n      this.showDetailDialog = true\n    },\n\n    filterNodes() {\n      this.renderGraph()\n    },\n\n    searchNodes() {\n      this.renderGraph()\n    },\n\n    resetGraph() {\n      this.selectedNodeType = 'all'\n      this.searchKeyword = ''\n      this.localMovieCount = 10\n      this.fetchGraphData()\n    },\n\n    onMovieCountChange() {\n      this.fetchGraphData()\n    }\n  }\n}\n</script>\n\n<style scoped>\n.knowledge-graph-container {\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  background-color: #FFFFFF;\n  overflow: hidden;\n  position: relative;\n  margin: 0;\n  padding: 0;\n}\n\n.graph-controls {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  padding: 12px 20px;\n  background-color: #F8F9FA;\n  border-bottom: 1px solid #E5E5E5;\n  flex-shrink: 0;\n  z-index: 10;\n  flex-wrap: wrap;\n}\n\n.type-selector {\n  width: 160px;\n  min-width: 160px;\n}\n\n.search-input {\n  flex: 1;\n  min-width: 200px;\n  max-width: 300px;\n}\n\n.movie-count-input {\n  width: 140px;\n  min-width: 140px;\n}\n\n.reset-btn {\n  background-color: #8A2BE2;\n  border-color: #8A2BE2;\n  color: white;\n  padding: 0 20px;\n}\n\n.reset-btn:hover {\n  background-color: #7B2BBE;\n  border-color: #7B2BBE;\n}\n\n/* 关键改进：画布占满剩余空间 */\n.graph-canvas {\n  flex: 1;\n  width: 100%;\n  min-height: 0; /* 防止flex项目溢出 */\n  overflow: hidden;\n  background-color: #FFFFFF;\n}\n\n/* 详情弹窗样式 */\n.detail-dialog {\n  border-radius: 8px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);\n}\n\n.detail-card {\n  padding: 24px;\n}\n\n.detail-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 20px;\n  padding-bottom: 16px;\n  border-bottom: 2px solid #F0F0F0;\n}\n\n.movie-title {\n  font-size: 20px;\n  font-weight: 700;\n  color: #333;\n  margin: 0;\n  line-height: 1.4;\n  flex: 1;\n}\n\n.movie-rating {\n  font-size: 14px;\n  color: #FFA500;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  font-weight: 600;\n  white-space: nowrap;\n  margin-left: 12px;\n}\n\n.detail-content {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n.detail-item {\n  display: flex;\n  align-items: flex-start;\n}\n\n.detail-label {\n  width: 60px;\n  font-size: 14px;\n  color: #666;\n  font-weight: 600;\n  flex-shrink: 0;\n}\n\n.detail-value {\n  flex: 1;\n  font-size: 14px;\n  color: #333;\n  line-height: 1.6;\n  word-break: break-word;\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n  .knowledge-graph-container {\n    height: 100vh;\n  }\n\n  .graph-controls {\n    padding: 10px 15px;\n    gap: 12px;\n  }\n\n  .type-selector,\n  .search-input,\n  .movie-count-input {\n    width: 100%;\n    min-width: unset;\n    max-width: unset;\n  }\n\n  .reset-btn {\n    width: 100%;\n    padding: 12px;\n  }\n\n  .graph-canvas {\n    height: calc(100vh - 160px);\n  }\n}\n\n@media (max-width: 480px) {\n  .graph-controls {\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .movie-title {\n    font-size: 18px;\n  }\n\n  .detail-label,\n  .detail-value {\n    font-size: 13px;\n  }\n}\n</style>"]}]}